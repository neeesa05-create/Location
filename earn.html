<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Spin & Win - Live Tracker</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;600;800&display=swap');:root{--primary-accent:#6a11cb;--secondary-accent:#2575fc;--gold-main:#FFD700;--gold-glow:#FFA500;--card-bg:rgba(255, 255, 255, 0.05);--body-bg:linear-gradient(160deg,#0f0c29 0%,#302b63 50%,#24243e 100%)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Poppins',sans-serif;background:var(--body-bg);color:#fff;min-height:100vh;display:flex;flex-direction:column;align-items:center;overflow-x:hidden}.header{width:100%;padding:20px;display:flex;align-items:center;justify-content:space-between}.back-btn{background:rgba(255,255,255,0.1);border:none;color:#fff;width:40px;height:40px;border-radius:50%;font-size:20px;cursor:pointer;transition:all 0.3s ease}.back-btn:hover{background:rgba(255,255,255,0.2);transform:scale(1.1)}.balance-badge{background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(218,165,32,0.2));border:1px solid rgba(255,215,0,0.4);padding:8px 16px;border-radius:30px;display:flex;align-items:center;gap:8px;font-weight:700}.coin-icon{color:var(--gold-main);filter:drop-shadow(0 0 5px var(--gold-glow))}.container{flex:1;display:flex;flex-direction:column;align-items:center;justify-content:center;width:100%;max-width:500px;padding:20px}.title{font-size:2rem;font-weight:800;text-transform:uppercase;background:linear-gradient(to right,#fff,#87CEEB);-webkit-background-clip:text;-webkit-text-fill-color:transparent;margin-bottom:40px;text-shadow:0 10px 20px rgba(0,0,0,0.5)}.wheel-container{position:relative;width:320px;height:320px;display:flex;justify-content:center;align-items:center;margin-bottom:50px}.wheel-border{position:absolute;width:100%;height:100%;border-radius:50%;border:10px solid rgba(255,255,255,0.1);box-shadow:0 0 30px rgba(106,17,203,0.5),inset 0 0 30px rgba(106,17,203,0.5);z-index:1}.wheel{width:280px;height:280px;border-radius:50%;background:conic-gradient(#e74c3c 0deg 60deg,#f1c40f 60deg 120deg,#2ecc71 120deg 180deg,#3498db 180deg 240deg,#9b59b6 240deg 300deg,#e67e22 300deg 360deg);position:relative;transition:transform 4s cubic-bezier(0.17,0.67,0.12,0.99);transform:rotate(0deg);box-shadow:0 0 15px rgba(0,0,0,0.5)}.marker{position:absolute;top:-25px;left:50%;transform:translateX(-50%);width:40px;height:50px;z-index:10;filter:drop-shadow(0 5px 5px rgba(0,0,0,0.5))}.marker svg{width:100%;height:100%;fill:#fff}.center-dot{position:absolute;width:50px;height:50px;background:#fff;border-radius:50%;z-index:5;box-shadow:0 0 15px rgba(0,0,0,0.3);display:flex;justify-content:center;align-items:center;font-weight:800;color:#333}.spin-btn{width:100%;max-width:280px;padding:20px;background:linear-gradient(90deg,var(--primary-accent),var(--secondary-accent));border:none;border-radius:15px;color:#fff;font-size:1.2rem;font-weight:700;letter-spacing:1px;cursor:pointer;transition:all 0.3s ease;text-transform:uppercase;box-shadow:0 10px 25px rgba(106,17,203,0.4);position:relative;overflow:hidden}.spin-btn::after{content:'';position:absolute;top:0;left:-100%;width:100%;height:100%;background:linear-gradient(90deg,transparent,rgba(255,255,255,0.3),transparent);transition:0.5s}.spin-btn:hover{transform:scale(1.05);box-shadow:0 15px 35px rgba(106,17,203,0.6)}.spin-btn:hover::after{left:100%}.spin-btn:disabled{filter:grayscale(1);cursor:not-allowed;transform:none}.labels{position:absolute;width:100%;height:100%;border-radius:50%}.label{position:absolute;top:50%;left:50%;transform-origin:0 0;color:#fff;font-weight:700;font-size:1.2rem;text-shadow:0 2px 4px rgba(0,0,0,0.5);user-select:none}.label:nth-child(1){transform:rotate(30deg) translate(80px) rotate(-30deg)}.label:nth-child(2){transform:rotate(90deg) translate(80px) rotate(-90deg)}.label:nth-child(3){transform:rotate(150deg) translate(80px) rotate(-150deg)}.label:nth-child(4){transform:rotate(210deg) translate(80px) rotate(-210deg)}.label:nth-child(5){transform:rotate(270deg) translate(80px) rotate(-270deg)}.label:nth-child(6){transform:rotate(330deg) translate(80px) rotate(-330deg)}#toast-container{position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:10px}.toast{padding:15px 20px;border-radius:8px;color:#fff;box-shadow:0 5px 15px rgba(0,0,0,0.3);display:flex;align-items:center;gap:10px;opacity:0;transform:translateX(100%);animation:toast-in 0.5s forwards}.toast.success{background:linear-gradient(90deg,#27ae60,#2ecc71)}.toast.error{background:linear-gradient(90deg,#c0392b,#e74c3c)}.modal-overlay{display:none;position:fixed;z-index:2000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,0.8);justify-content:center;align-items:center;backdrop-filter:blur(8px)}.modal-overlay.active{display:flex}.win-modal{background:rgba(20,20,30,0.95);border:1px solid rgba(255,215,0,0.3);padding:40px;border-radius:20px;text-align:center;animation:popIn 0.5s cubic-bezier(0.17,0.67,0.12,1.2);box-shadow:0 0 50px rgba(255,215,0,0.2)}.win-icon{font-size:4rem;margin-bottom:20px;animation:bounce 2s infinite}.win-title{font-size:1.8rem;margin-bottom:10px;color:var(--gold-main)}.win-desc{color:#ccc;margin-bottom:30px}.claim-btn{padding:15px 40px;background:linear-gradient(90deg,#f1c40f,#e67e22);border:none;border-radius:10px;font-weight:700;font-size:1.1rem;cursor:pointer;color:#000;transition:0.3s}.claim-btn:hover{transform:scale(1.1);box-shadow:0 0 20px rgba(241,196,15,0.5)}@keyframes toast-in{to{opacity:1;transform:translateX(0)}}@keyframes popIn{from{opacity:0;transform:scale(0.5)}to{opacity:1;transform:scale(1)}}@keyframes bounce{0%,20%,50%,80%,100%{transform:translateY(0)}40%{transform:translateY(-20px)}60%{transform:translateY(-10px)}}</style></head><body><div class="header"><button class="back-btn" onclick="window.location.href='dashboard.html'">‚Üê</button><div class="balance-badge"><span class="coin-icon">‚óè</span><span id="balance">0</span></div></div><div class="container"><h1 class="title">Spin to Win</h1><div class="wheel-container"><div class="marker"><svg viewBox="0 0 24 24"><path d="M12 22L12 2M12 22L2 12M12 22L22 12" stroke="none" fill="#fff"></path><path d="M4 0h16v12l-8 10-8-10z"></path></svg></div><div class="wheel-border"></div><div class="wheel" id="wheel"><div class="labels"><div class="label">5</div><div class="label">15</div><div class="label">5</div><div class="label">10</div><div class="label">5</div><div class="label">20</div></div></div><div class="center-dot">‚òÖ</div></div><button class="spin-btn" id="spin-btn">Spin Wheel</button></div><div id="win-modal" class="modal-overlay"><div class="win-modal"><div class="win-icon">üèÜ</div><h2 class="win-title">Congratulations!</h2><p class="win-desc">You've won <span id="win-display-amount">5</span> Coins.</p><button class="claim-btn" id="claim-btn">Watch Ad to Claim</button></div></div><div id="toast-container"></div><script>let supabase;let user;let currentRotation=0;const segments=[5,15,5,10,5,20];async function initApp(){try{const response=await fetch("/api/config");const config=await response.json();supabase=window.supabase.createClient(config.supabaseUrl,config.supabaseAnonKey);const{data:{session}}=await supabase.auth.getSession();if(!session){window.location.href="login.html";return}user=session.user;fetchBalance()}catch(err){showToast("Connection Failed","error")}}async function fetchBalance(){const{data,error}=await supabase.from("users").select("coins").eq("id_auth",user.id).single();if(data){document.getElementById("balance").textContent=data.coins}}document.getElementById("spin-btn").addEventListener("click",startSpin);document.getElementById("claim-btn").addEventListener("click",watchAdAndClaim);function startSpin(){const btn=document.getElementById("spin-btn");btn.disabled=true;const spins=Math.floor(Math.random()*5)+5;const segmentAngle=360/segments.length;const winningIndices=[0,2,4];const forcedIndex=winningIndices[Math.floor(Math.random()*winningIndices.length)];const randomOffset=Math.floor(Math.random()*20)-10;const targetRotation=(spins*360)+(360-(forcedIndex*segmentAngle))+randomOffset;currentRotation+=targetRotation;const wheel=document.getElementById("wheel");wheel.style.transform=`rotate(${currentRotation}deg)`;setTimeout(()=>{showWinModal(5)},4000)}function showWinModal(amount){const modal=document.getElementById("win-modal");document.getElementById("win-display-amount").textContent=amount;modal.classList.add("active")}function watchAdAndClaim(){const btn=document.getElementById("claim-btn");btn.textContent="Loading Ad...";btn.disabled=true;if(typeof AndroidNative!=='undefined'&&AndroidNative.showRewardedAdForCoins){AndroidNative.showRewardedAdForCoins()}else{setTimeout(()=>{finalizeClaim()},2000)}}async function finalizeClaim(){const btn=document.getElementById("claim-btn");try{const{data,error}=await supabase.rpc('claim_reward');if(error)throw error;if(data===true){showToast(`Added 5 Coins!`,"success");document.getElementById("win-modal").classList.remove("active");document.getElementById("spin-btn").disabled=false;fetchBalance()}else{showToast("Wait! Don't click too fast.","error")}}catch(err){console.error(err);showToast("Failed: "+(err.message||"Unknown"),"error")}finally{btn.textContent=`Watch Ad to Claim`;btn.disabled=false}}function showToast(message,type="success"){const container=document.getElementById("toast-container");const toast=document.createElement("div");toast.className=`toast ${type}`;const icon=type==="success"?"‚úì":"‚úó";toast.innerHTML=`<span>${icon}</span><span>${message}</span>`;container.appendChild(toast);setTimeout(()=>{toast.style.animation="toast-out .5s forwards";setTimeout(()=>toast.remove(),500)},4e3)}document.addEventListener("DOMContentLoaded",initApp);</script></body></html>
