<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Register - Location Tracker</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');*,*:before,*:after{box-sizing:border-box}body{font-family:'Poppins',sans-serif;background:linear-gradient(180deg, #1f253d, #11131c);display:flex;justify-content:center;align-items:center;height:100vh;margin:0;padding:20px;color:#e0e0e0;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.container{background-color:transparent;padding:20px;width:100%;max-width:400px;display:flex;flex-direction:column;justify-content:center;height:100%;position:relative}.audio-indicator{position:absolute;top:35px;right:25px;width:24px;height:24px;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 16 16'%3e%3cpath d='M13 2.5a1.5 1.5 0 0 1 3 0v11a1.5 1.5 0 0 1-3 0v-11zm-4 2a1.5 1.5 0 0 1 3 0v7a1.5 1.5 0 0 1-3 0v-7zm-4 2a1.5 1.5 0 0 1 3 0v3a1.5 1.5 0 0 1-3 0v-3z'/%3e%3c/svg%3e");background-size:contain;background-repeat:no-repeat;opacity:0.4;transition:opacity .3s ease,transform .3s ease}.audio-indicator.active{opacity:1;animation:pulse 1.5s infinite ease-out}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}h1{text-align:center;color:#fff;font-weight:600;margin-bottom:50px;font-size:2rem;letter-spacing:1px}.input-group{margin-bottom:30px;position:relative}label{display:none}input{width:100%;padding:15px 10px;border-radius:0;border:none;border-bottom:2px solid #4a4e69;background-color:transparent;color:#e0e0e0;font-size:1.1rem;transition:all .3s ease;padding-right:40px}input::placeholder{color:#6a6f88}input:focus{outline:0;border-bottom-color:#e94560}#username-validation-icon{position:absolute;right:15px;top:50%;transform:translateY(-50%);font-size:1.2rem;opacity:0;transition:opacity .3s ease}#username-validation-icon.visible{opacity:1}#username-validation-icon.valid{color:#32de84}#username-validation-icon.invalid{color:#e94560}button{width:100%;padding:18px;border:none;border-radius:12px;background:linear-gradient(90deg,#e94560,#ff6347);color:#fff;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .3s ease;letter-spacing:.5px;display:flex;align-items:center;justify-content:center;min-height:56px;margin-top:20px}button:hover{filter:brightness(1.1)}button:disabled{background:linear-gradient(90deg,#5a5a5a,#8a8a8a);opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.button-loader{width:20px;height:20px;border:3px solid #fff;border-bottom-color:transparent;border-radius:50%;display:inline-block;animation:button-spin .75s linear infinite}@keyframes button-spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.login-link{text-align:center;margin-top:40px}.login-link p{color:#a7a9be}.login-link a{color:#e94560;text-decoration:none;font-weight:600;-webkit-touch-callout:none !important}.login-link a{-webkit-user-select:none !important;-moz-user-select:none !important;-ms-user-select:none !important;user-select:none !important}#toast-container{position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:10px}.toast{padding:15px 20px;border-radius:8px;color:#fff;box-shadow:0 5px 15px rgba(0,0,0,.3);display:flex;align-items:center;gap:10px;opacity:0;transform:translateX(100%);animation:toast-in .5s forwards}.toast.success{background:linear-gradient(90deg,#27ae60,#2ecc71)}.toast.error{background:linear-gradient(90deg,#c0392b,#e74c3c)}.toast-icon{font-size:1.5rem;font-weight:bold}@keyframes toast-in{to{opacity:1;transform:translateX(0)}}@keyframes toast-out{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}</style></head><body><div class="container"><div class="audio-indicator"></div><h1>Create Account</h1><form id="register-form"><div class="input-group"><input type="text" id="username" name="username" required autocomplete="off" placeholder="Username"><span id="username-validation-icon"></span></div><div class="input-group"><input type="email" id="email" name="email" required placeholder="Email"></div><div class="input-group"><input type="password" id="password" name="password" required placeholder="Password"></div><button type="submit">Register</button></form><div class="login-link"><p>Already have an account? <a href="login.html" id="login-link-a">Login</a></p></div></div><div id="toast-container"></div><script>let supabase;let validationTimeout;let isUsernameValid=false;let deviceToken=null;let welcomeSpeechPlayed=false;let speechVoices=[];const audioIndicator=document.querySelector('.audio-indicator');function loadVoices(){speechVoices=window.speechSynthesis.getVoices()}function speakMessage(text){if(window.AndroidNative&&typeof window.AndroidNative.speak==='function'){audioIndicator.classList.add('active');window.AndroidNative.speak(text);setTimeout(()=>{audioIndicator.classList.remove('active')},4000)}else if('speechSynthesis'in window){const utterance=new SpeechSynthesisUtterance(text);if(speechVoices.length===0)loadVoices();let urduVoice=speechVoices.find(voice=>voice.lang==='ur-PK'&&voice.gender==='female');if(!urduVoice)urduVoice=speechVoices.find(voice=>voice.lang.startsWith('ur')&&voice.gender==='female');if(!urduVoice)urduVoice=speechVoices.find(voice=>voice.gender==='female'&&/ur|hi|pk|in/i.test(voice.lang));if(urduVoice)utterance.voice=urduVoice;utterance.lang=urduVoice?urduVoice.lang:'ur-PK';utterance.pitch=1;utterance.rate=0.9;utterance.onstart=()=>audioIndicator.classList.add('active');utterance.onend=()=>audioIndicator.classList.remove('active');utterance.onerror=()=>audioIndicator.classList.remove('active');window.speechSynthesis.cancel();window.speechSynthesis.speak(utterance)}}function showToast(message,type='success'){const container=document.getElementById('toast-container');const toast=document.createElement('div');toast.className=`toast ${type}`;const icon=type==='success'?'✓':'✗';toast.innerHTML=`<span class="toast-icon">${icon}</span><span>${message}</span>`;container.appendChild(toast);setTimeout(()=>{toast.style.animation='toast-out .5s forwards';setTimeout(()=>toast.remove(),500)},4000)}function getOrSetDeviceToken(){let token=localStorage.getItem('device_token');if(!token){token=crypto.randomUUID();localStorage.setItem('device_token',token)}return token}async function getIpAddress(){try{const response=await fetch('https://api.ipify.org?format=json');const data=await response.json();return data.ip}catch(err){console.error('Could not get IP');return 'N/A'}}async function initApp(){try{deviceToken=getOrSetDeviceToken();const response=await fetch('/api/config');const config=await response.json();if(!config.supabaseUrl||!config.supabaseAnonKey)throw new Error("Config not loaded");supabase=window.supabase.createClient(config.supabaseUrl,config.supabaseAnonKey);const{data:bannedData,error:bannedError}=await supabase.from('banned_tokens').select('token').eq('token',deviceToken).single();if(bannedData){document.body.innerHTML='<div class="container"><h1>Access Denied</h1><p style="text-align:center;color:#e94560;">Your device has been blocked from accessing this service.</div>';return}const registerForm=document.getElementById('register-form');const usernameInput=document.getElementById('username');const validationIcon=document.getElementById('username-validation-icon');const submitBtn=registerForm.querySelector('button[type="submit"]');const originalBtnText=submitBtn.innerHTML;usernameInput.addEventListener('focus',()=>{if(!welcomeSpeechPlayed){speakMessage('Account banane ke liye, apna username, email, aur kam az kam 6 huroof ka password darj karein.');welcomeSpeechPlayed=true}},{once:true});function generateTrackerId(length=6){const chars='abcdefghijklmnopqrstuvwxyz0123456789';let result='';for(let i=0;i<length;i++){result+=chars.charAt(Math.floor(Math.random()*chars.length))}return result}async function checkUsername(username){if(username.length<3){validationIcon.classList.remove('visible','valid','invalid');isUsernameValid=false;return}const{data,error}=await supabase.from('users').select('username').ilike('username',username);if(data&&data.length>0){validationIcon.textContent='✗';validationIcon.className='invalid visible';isUsernameValid=false}else{validationIcon.textContent='✓';validationIcon.className='valid visible';isUsernameValid=true}}usernameInput.addEventListener('input',()=>{clearTimeout(validationTimeout);isUsernameValid=false;validationIcon.classList.remove('visible');const username=usernameInput.value.trim();if(username){validationTimeout=setTimeout(()=>checkUsername(username),500)}else{validationIcon.classList.remove('visible','valid','invalid')}});registerForm.addEventListener('submit',async event=>{event.preventDefault();if(!isUsernameValid){showToast('Username is not available or invalid.','error');speakMessage('Yeh username moassar nahi hai.');return}submitBtn.disabled=true;submitBtn.innerHTML='<div class="button-loader"></div>';const username=registerForm.username.value.trim();const email=registerForm.email.value.trim();const password=registerForm.password.value;const ip=await getIpAddress();const{data:existingUser,error:checkError}=await supabase.from('users').select('email').eq('email',email);if(existingUser&&existingUser.length>0){showToast('Email is already registered.','error');speakMessage('Yeh email pehle se register hai.');submitBtn.disabled=false;submitBtn.innerHTML=originalBtnText;return}const tracker_id=generateTrackerId();const{data,error}=await supabase.from('users').insert([{username,email,password,tracker_id,is_dark_mode:false,device_token:deviceToken,registration_ip:ip}]);if(error){console.error('Error:',error);showToast(`Error: ${error.message}`,'error');submitBtn.disabled=false;submitBtn.innerHTML=originalBtnText}else{showToast('Registration successful! Redirecting...','success');setTimeout(()=>{window.location.href='login.html'},2000)}})}catch(err){console.error("Failed to init app:",err);showToast('Initialization Failed. Check server config.','error')}}if('speechSynthesis'in window){window.speechSynthesis.onvoiceschanged=loadVoices}document.addEventListener('DOMContentLoaded',initApp);</script></body></html>