<!DOCTYPE html><html lang="en"><head><meta charset="UTF-8"><meta name="viewport" content="width=device-width, initial-scale=1.0, user-scalable=no"><title>Login - Location Tracker</title><script src="https://cdn.jsdelivr.net/npm/@supabase/supabase-js@2"></script><style>@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@400;500;600;700&display=swap');*,*:before,*:after{box-sizing:border-box}body{font-family:'Poppins',sans-serif;background:linear-gradient(180deg, #1f253d, #11131c);display:flex;justify-content:center;align-items:center;height:100vh;margin:0;padding:20px;color:#e0e0e0;user-select:none;-webkit-user-select:none;-moz-user-select:none;-ms-user-select:none}.container{background-color:transparent;padding:20px;width:100%;max-width:400px;display:flex;flex-direction:column;justify-content:center;height:100%;position:relative}.audio-indicator{position:absolute;top:35px;right:25px;width:24px;height:24px;background-image:url("data:image/svg+xml,%3csvg xmlns='http://www.w3.org/2000/svg' fill='white' viewBox='0 0 16 16'%3e%3cpath d='M13 2.5a1.5 1.5 0 0 1 3 0v11a1.5 1.5 0 0 1-3 0v-11zm-4 2a1.5 1.5 0 0 1 3 0v7a1.5 1.5 0 0 1-3 0v-7zm-4 2a1.5 1.5 0 0 1 3 0v3a1.5 1.5 0 0 1-3 0v-3z'/%3e%3c/svg%3e");background-size:contain;background-repeat:no-repeat;opacity:0.4;transition:opacity .3s ease,transform .3s ease}.audio-indicator.active{opacity:1;animation:pulse 1.5s infinite ease-out}@keyframes pulse{0%{transform:scale(1)}50%{transform:scale(1.1)}100%{transform:scale(1)}}h1{text-align:center;color:#fff;font-weight:600;margin-bottom:50px;font-size:2rem;letter-spacing:1px}h1{text-align:center;color:#fff;font-weight:600;margin-bottom:50px;font-size:2rem;letter-spacing:1px}.input-group{margin-bottom:30px;position:relative}label{display:none}input{width:100%;padding:15px 10px;border-radius:0;border:none;border-bottom:2px solid #4a4e69;background-color:transparent;color:#e0e0e0;font-size:1.1rem;transition:all .3s ease}input::placeholder{color:#6a6f88}input:focus{outline:0;border-bottom-color:#e94560}#login-btn{width:100%;padding:18px;border:none;border-radius:12px;background:linear-gradient(90deg,#e94560,#ff6347);color:#fff;font-size:1.1rem;font-weight:600;cursor:pointer;transition:all .3s ease;letter-spacing:.5px;display:flex;align-items:center;justify-content:center;min-height:56px}#login-btn:hover{filter:brightness(1.1)}#login-btn:disabled{opacity:.7;cursor:not-allowed;transform:none;box-shadow:none}.button-loader{width:20px;height:20px;border:3px solid #fff;border-bottom-color:transparent;border-radius:50%;display:inline-block;animation:button-spin .75s linear infinite}@keyframes button-spin{0%{transform:rotate(0)}100%{transform:rotate(360deg)}}.social-login-header{text-align:center;color:#a7a9be;margin:40px 0 20px}.social-login-grid{display:flex;justify-content:center;gap:20px}.social-btn{background-color:#2a2d3b;border:1px solid #4a4e69;color:#e0e0e0;width:60px;height:60px;border-radius:50%;display:flex;align-items:center;justify-content:center;cursor:pointer;transition:all .3s ease}.social-btn:hover{border-color:#e94560;background-color:#3a3d4b}.social-btn svg{width:24px;height:24px}.register-link{text-align:center;margin-top:40px}.register-link p{color:#a7a9be}.register-link a{color:#e94560;text-decoration:none;font-weight:600;-webkit-touch-callout:none !important}.register-link a{-webkit-user-select:none !important;-moz-user-select:none !important;-ms-user-select:none !important;user-select:none !important}#toast-container{position:fixed;top:20px;right:20px;z-index:9999;display:flex;flex-direction:column;gap:10px}.toast{padding:15px 20px;border-radius:8px;color:#fff;box-shadow:0 5px 15px rgba(0,0,0,.3);display:flex;align-items:center;gap:10px;opacity:0;transform:translateX(100%);animation:toast-in .5s forwards}.toast.success{background:linear-gradient(90deg,#27ae60,#2ecc71)}.toast.error{background:linear-gradient(90deg,#c0392b,#e74c3c)}.toast-icon{font-size:1.5rem;font-weight:bold}@keyframes toast-in{to{opacity:1;transform:translateX(0)}}@keyframes toast-out{from{opacity:1;transform:translateX(0)}to{opacity:0;transform:translateX(100%)}}</style></head><body><div class="container"><div class="audio-indicator"></div><h1>Welcome Back</h1><form id="login-form"><div class="input-group"><input type="text" id="username" name="username" required placeholder="Username"></div><div class="input-group"><input type="password" id="password" name="password" required placeholder="Password"></div><button type="submit" id="login-btn">Login</button></form><p class="social-login-header">Or continue with</p><div class="social-login-grid"><button class="social-btn" title="Google"><svg viewBox="0 0 48 48"><path fill="#FFC107" d="M43.611,20.083H42V20H24v8h11.303c-1.649,4.657-6.08,8-11.303,8c-6.627,0-12-5.373-12-12c0-6.627,5.373-12,12-12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C12.955,4,4,12.955,4,24c0,11.045,8.955,20,20,20c11.045,0,20-8.955,20-20C44,22.659,43.862,21.35,43.611,20.083z"></path><path fill="#FF3D00" d="M6.306,14.691l6.571,4.819C14.655,15.108,18.961,12,24,12c3.059,0,5.842,1.154,7.961,3.039l5.657-5.657C34.046,6.053,29.268,4,24,4C16.318,4,9.656,8.337,6.306,14.691z"></path><path fill="#4CAF50" d="M24,44c5.166,0,9.86-1.977,13.409-5.192l-6.19-5.238C29.211,35.091,26.715,36,24,36c-5.223,0-9.657-3.356-11.303-8H6.306C9.656,35.663,16.318,40,24,40z"></path><path fill="#1976D2" d="M43.611,20.083H42V20H24v8h11.303c-0.792,2.237-2.231,4.166-4.087,5.571l6.19,5.238C42.01,35.637,44,30.138,44,24C44,22.659,43.862,21.35,43.611,20.083z"></path></svg></button><button class="social-btn" title="Facebook"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M22 12c0-5.523-4.477-10-10-10S2 6.477 2 12c0 4.991,3.657,9.128,8.438,9.879V14.89h-2.54V12h2.54V9.797c0-2.506,1.492-3.89,3.777-3.89,1.094,0,2.238,.195,2.238,.195v2.46h-1.26c-1.243,0-1.63,.771-1.63,1.562V12h2.773l-.443,2.89h-2.33v7.029C18.343,21.128,22,16.991,22,12z"></path></svg></button><button class="social-btn" title="Microsoft"><svg viewBox="0 0 21 21" fill="currentColor"><path d="M1 1h9v9H1z" fill="#f25022"></path><path d="M11 1h9v9h-9z" fill="#7fba00"></path><path d="M1 11h9v9H1z" fill="#00a4ef"></path><path d="M11 11h9v9h-9z" fill="#ffb900"></path></svg></button><button class="social-btn" title="X"><svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244,2.25h3.308l-7.227,8.26,8.502,11.24H16.17l-5.214-6.817L4.99,21.75H1.68l7.73-8.835L1.254,2.25H8.08l4.713,6.231Zm-1.161,17.52h1.833L7.084,4.126H5.117Z"></path></svg></button></div><div class="register-link"><p>No account? <a href="index.html" id="register-link-a">Register now</a></p></div></div><div id="toast-container"></div><script>let supabase;let speechVoices=[];const audioIndicator=document.querySelector('.audio-indicator');function loadVoices(){speechVoices=window.speechSynthesis.getVoices()}function speakMessage(text){if(window.AndroidNative&&typeof window.AndroidNative.speak==='function'){audioIndicator.classList.add('active');window.AndroidNative.speak(text);setTimeout(()=>{audioIndicator.classList.remove('active')},4000)}else if('speechSynthesis'in window){const utterance=new SpeechSynthesisUtterance(text);if(speechVoices.length===0)loadVoices();let urduVoice=speechVoices.find(voice=>voice.lang==='ur-PK'&&voice.gender==='female');if(!urduVoice)urduVoice=speechVoices.find(voice=>voice.lang.startsWith('ur')&&voice.gender==='female');if(!urduVoice)urduVoice=speechVoices.find(voice=>voice.gender==='female'&&/ur|hi|pk|in/i.test(voice.lang));if(urduVoice)utterance.voice=urduVoice;utterance.lang=urduVoice?urduVoice.lang:'ur-PK';utterance.pitch=1;utterance.rate=0.9;utterance.onstart=()=>audioIndicator.classList.add('active');utterance.onend=()=>audioIndicator.classList.remove('active');utterance.onerror=()=>audioIndicator.classList.remove('active');window.speechSynthesis.cancel();window.speechSynthesis.speak(utterance)}}function showToast(message,type='success'){const container=document.getElementById('toast-container');const toast=document.createElement('div');toast.className=`toast ${type}`;const icon=type==='success'?'✓':'✗';toast.innerHTML=`<span class="toast-icon">${icon}</span><span>${message}</span>`;container.appendChild(toast);setTimeout(()=>{toast.style.animation='toast-out .5s forwards';setTimeout(()=>toast.remove(),500)},4000)}

// Function to get or create a unique device ID
function getOrSetDeviceToken(){
    let token = localStorage.getItem('device_token');
    if(!token){
        token = crypto.randomUUID();
        localStorage.setItem('device_token', token);
    }
    return token;
}

async function initApp(){
    try{
        const deviceToken = getOrSetDeviceToken(); // Get device ID
        const response=await fetch('/api/config');
        const config=await response.json();
        if(!config.supabaseUrl||!config.supabaseAnonKey){throw new Error("Config not loaded")}
        supabase=window.supabase.createClient(config.supabaseUrl,config.supabaseAnonKey);

        // BAN CHECK: Check if this device's token is in the banned list
        const { data: bannedData, error: bannedError } = await supabase
            .from('banned_tokens')
            .select('token')
            .eq('token', deviceToken)
            .single();

        if (bannedData) {
            // If device is banned, show the access denied message and stop
            document.body.innerHTML = '<div class="container"><h1>Access Denied</h1><p style="text-align:center;color:#e94560;">Your device has been blocked from accessing this service.</div>';
            return; 
        }

        // If not banned, continue with the normal login page setup
        const loginForm=document.getElementById('login-form');
        const submitBtn=loginForm.querySelector('button[type="submit"]');
        const originalBtnText=submitBtn.innerHTML;
        loginForm.addEventListener('submit',async event=>{
            event.preventDefault();
            submitBtn.disabled=true;
            submitBtn.innerHTML='<div class="button-loader"></div>';
            const username=loginForm.username.value;
            const password=loginForm.password.value;
            const{data,error}=await supabase.from('users').select('*').eq('username',username).single();
            if(error||!data){
                speakMessage('Aapka username ya password ghalat hai. Baraye meharbani dobara koshish karein.');
                showToast('Invalid username or password.','error');
                submitBtn.disabled=false;
                submitBtn.innerHTML=originalBtnText;
                return;
            }
            if(data.is_suspended){
                const msg='Access Denied: This account has been suspended due to suspicious activity.';
                speakMessage('Access Denied. Is account ko mashkook sargarmi ki wajah se suspend kar diya gaya hai.');
                showToast(msg,'error');
                submitBtn.disabled=false;
                submitBtn.innerHTML=originalBtnText;
                return;
            }
            if(data.password!==password){
                speakMessage('Aapka username ya password ghalat hai. Baraye meharbani dobara koshish karein.');
                showToast('Invalid username or password.','error');
                submitBtn.disabled=false;
                submitBtn.innerHTML=originalBtnText;
                return;
            }
            showToast('Login successful! Initializing...','success');
            localStorage.setItem('loggedInUser',username);
            setTimeout(()=>{window.location.href='loader.html'},1500)
        });
    }catch(err){
        console.error("Failed to init app:",err);
        showToast('Initialization Failed. Check server config.','error')
    }
}
if('speechSynthesis'in window){window.speechSynthesis.onvoiceschanged=loadVoices}
document.addEventListener('DOMContentLoaded',initApp);
</script></body></html> 
